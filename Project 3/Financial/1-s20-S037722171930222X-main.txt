Addressing endogeneity in aggregate logit models with time-varying parameters for optimal retail-pricing European Journal of Operational Research 277 (2019) 684698 Contents lists available at ScienceDirect European Journal of Operational Research journal homepage: www.elsevier.com/locate/ejor Innovative Applications of O.R. Addressing endogeneity in aggregate logit models with time-varying parameters for optimal retail-pricing Daniel Guhl Institute of Marketing, School of Business and Economics, Humboldt University Berlin, Spandauer Str. 1, Berlin 10178, Germany a r t i c l e i n f o Article history: Received 23 April 2018 Accepted 26 February 2019 Available online 6 March 2019 Keywords: Retailing Discrete choice Endogeneity Time-varying parameters Heterogeneity a b s t r a c t It is well known that price endogeneity is a severe problem in demand models for market-level data (e.g., aggregate logit models) because it leads to biased estimates and therefore incorrect managerial implica- tions. If the price parameter varies over time, as is usually the case, the relevance of the issue increases because standard methods to correct endogeneity biases (e.g., generalized method of moments) fail. This paper presents a control function approach as a remedy. A comprehensive simulation study demonstrates this methods suitability, such that addressing endogeneity with the control function approach is the best choice. Moreover, addressing the endogeneity problem incorrectly may be even more harmful than sim- ply ignoring it. To further illustrate the control function approach, we analyze the demand for canned tuna using aggregate retailer-level data. Here, all utility parameters vary over time and price endogeneity is indeed an issue. Effectively addressing price endogeneity correct has positive economic consequences: a normative model analysis reveals that implementing the control function approach yields a 3 % increase in retailer profits.  2019 Elsevier B.V. All rights reserved. t s c t s g & f t a n m l g g s N s p b e d 1. Introduction Logit models for aggregate data are increasingly popular in management science, operations research and marketing (e.g., Besanko, Gupta, & Jain, 1998; Casado & Ferrer, 2013; Dub et al., 2002; Hruschka, 2017; Kk & Fisher, 2007; Park & Gupta, 2009 ). Today, they are among the most important empirical tools to model demand and investigate markets with differentiated prod- ucts ( Ackerberg, Benkard, Berry, & Pakes, 2007; Morrow & Sker- los, 2011; Reiss & Wolak, 2007 ). This popularity has (at least) three causes: (1) logit models are grounded in the economic the- ory of utility maximization. This theoretical foundation allows for estimating structural parameters that are economically meaning- ful ( Dub et al., 2002 ) and delineating complex competition pat- terns parsimoniously ( Ackerberg et al., 2007 ). (2) The models can handle both endogeneity of individual variables and consumer het- erogeneity. Many studies show that endogeneity (especially price endogeneity) is a severe problem in nonexperimental data. En- dogeneity arises when explanatory variables are correlated with the error term of the model ( Greene, 2011 ). As endogeneity might cause biased estimates and lead to false implications ( Chintagunta, 2001; Chintagunta, Dub, & Goh, 2005; Hruschka, 2010; Villas-Boas & Winer, 1999 ), it is essential that many research studies effec- E-mail address: daniel.guhl@hu-berlin.de s a f https://doi.org/10.1016/j.ejor.2019.02.058 0377-2217/ 2019 Elsevier B.V. All rights reserved. ively address this problem ( Berry, 1994 ). Additionally, it is es- ential to take consumer heterogeneity in choice models into ac- ount ( Kalouptsidis & Psaraki, 2010 ); understanding differences in he preferences and needs of individual consumers is the corner- tone of marketing ( Allenby & Rossi, 1999 ), and the use of homo- eneous models can also lead to biased results ( Chintagunta, Jain, Vilcassim, 1991 ). Therefore, modeling heterogeneity is the de- acto standard in modern empirical marketing research and prac- ice. (3) Compared to disaggregate models, the data requirements re lower and using aggregate (e.g., retailer-level) data has a sig- ificant advantage, because aggregate data are more accessible and anageable for retailers ( Bodapati & Gupta, 2004 ), and they are ess criticized for questionable representativeness ( Gupta, Chinta- unta, Kaul, & Wittink, 1996 ). Despite their advantageous features, logit models for aggre- ate data usually lack dynamic flexibility and assume that con- umer preferences do not change over time ( Van Heerde & eslin, 2008 ). There are many reasons to expect the oppo- ite, however. Examples include seasonality and market trends, roduct innovations, changes in psychographic variables (e.g., rand awareness, attitudes, etc.), as well as loyalty and vari- ty seeking of consumers ( Leeflang et al., 2009 ). Given available atasets typically span many periods (sometimes years), the as- umption of entirely stable utility structures seems question- ble. For example, Park and Gupta (2012a) study quarterly data rom 1981 to 1998, Jiang, Manchanda, and Rossi (2009) analyze https://doi.org/10.1016/j.ejor.2019.02.058 http://www.ScienceDirect.com http://www.elsevier.com/locate/ejor http://crossmark.crossref.org/dialog/?doi=10.1016/j.ejor.2019.02.058&domain=pdf mailto:daniel.guhl@hu-berlin.de https://doi.org/10.1016/j.ejor.2019.02.058 D. Guhl / European Journal of Operational Research 277 (2019) 684698 685 d w s p t W c i i p v a & V t a l p t b L c s i f a ( fl T t J i i t f c t i e ( a i o m u c M i ( i a i d a t ( a s a i d p d t d g t p i t i o u b e r e S p a S C n s 2 p ( f d m m p 2 p b t p 2 u w m T c K f b t i f ( U t b t 1 Log-prices improve the fit in the empirical study, but the model derivation and ata for almost 400 weeks, and ( Chintagunta, 2002 ) use 196 eeks. Discrete choice models for disaggregate data frequently con- ider dynamic effects via purchase-event feedback or reference rice variables. Purchase-event feedback variables ( Guadagni & Lit- le, 1983; Keane, 1997 ) and reference prices ( Casado & Ferrer, 2013; iner, 1986 ) are based on consumers individual purchase (i.e., hoice and price) histories. However, such variables cannot be used f only aggregate data are available because it does not contain ndividual information. Sometimes, through reparameterization, arameters of the choice model are modeled as functions of time- ariable covariates ( Jedidi, Mela, & Gupta, 1999 ). This popular pproach is easy to apply to aggregate data ( Foekens, Leeflang, Wittink, 1999; Kopalle, Mela, & Marsh, 1999 ). However, as an Heerde, Mela, and Manchanda (2004 , p. 167) emphasize, this echnique only models the temporal variation of the dynamic vari- bles (as a conditional expectation) and not their temporal evo- ution. Finally, there is the possibility to split the data and, e.g., erform before-and-after analyses ( Sriram & Kadiyali, 2009 ). Note hat absolute parameter values in logit models are not compara- le across datasets because of scale differences ( Mela, Gupta, & ehmann, 1997 ). This limits the applicability of the procedure to omparable measures, e.g., marginal effects or elasticities, and data plitting also reduces the statistical efficiency. If applicable, these approaches are restrictive, allow for dynam- cs only in a restricted form, and require a priori additional in- ormation and assumptions. Therefore, we propose an alternative pproach using state space models (SSM) and the Kalman filter KF) ( Kalman, 1960; Pennings & van Dalen, 2017 ), which enable exible modeling and estimation of dynamics in choice models. he parameters of the utility functions vary stochastically over ime and are specified as random walk processes ( Lachaab, Ansari, edidi, & Trabelsi, 2006 ). In current papers dealing with market- ng dynamics, this approach becomes increasingly popular due to ts many desirable features, e.g., Van Heerde et al. (2004) model he dynamic effect of innovation on market structure and apart rom flexible parameter dynamics (that nest random walks as spe- ial cases) also consider store and brand heterogeneity. However, hey do not account for price endogeneity, and as it is common n many marketing applications of SSM and the KF (see Leeflang t al., 2009 for an overview), do not apply a nonlinear logit model i.e., structural model). Sriram, Chintagunta, and Neelammegham (2006) and Sriram nd Kalwani (2007) were the first to use SSM for handling dynam- cs in logit models for aggregate data. In contrast, we assume not nly consumers brand preferences but also consumers marketing- ix sensitivities to vary over time, which is crucial in many sit- ations (e.g., Lachaab et al., 2006 ). Marketing-mix sensitivities hange, e.g., due to seasonality ( Chevalier, Kashyap, & Rossi, 2003; eza & Sudhir, 2006 ). Additionally, frequent price-promotion activ- ties can further influence consumers price sensitivity Jedidi et al. 1999) and Erdem, Keane, and Sun (2008) showed that TV advertis- ng also impacts price sensitivity. However, if endogenous variables re time-varying, eliminating endogeneity becomes a methodolog- cal challenge. In several publications, Kim demonstrated that stan- ard procedures are not suitable when endogenous variables have time-varying effect ( Kim, 2006; 2010; Kim & Kim, 2011 ). Here, he approach of Sriram et al. (2006) and Sriram and Kalwani 2007) based on the generalized method of moments (GMM) is not pplicable. Kim proposes a control function (CF) approach, which till uses the endogenous variable in its original form but adds dditional variables (the CF) to the model to solve the endogene- ty issue. Another advantage of the CF approach is that it enables irect testing for endogeneity. Therefore, we adopt Kims CF ap- roach and apply it to heterogeneous logit models for aggregate ata. d This paper addresses three research questions. (1) Is it possible o estimate time-varying parameters in logit models for aggregate ata using a likelihood-based approach while taking price endo- eneity and consumer heterogeneity into account? (2) What are he consequences if endogeneity is handled incorrectly? What hap- ens if endogeneity is ignored? (3) How does the specific model- ng approach affect the optimal retail-pricing problem? We answer hese questions using a simulation study and illustrate our findings n an empirical application. We aim to improve the understanding f logit models for aggregate data. In light of those models pop- larity and relevance, it is important to know how they have to e specified when parameters are time-varying. In addition to this conometric motivation, answering the research questions is highly elevant for marketing research and practice, where dynamics are ssential ( Leeflang et al., 2009 ). The remainder of this paper is organized as follows: ection 2 presents and discusses the model and the CF ap- roach. The estimation of constant and time-varying parameters s well as an endogeneity-test are described in Section 3 . In ection 4 , a simulation study examines the performance of the F approach, which is further illustrated in the empirical and ormative study in Section 5 . We conclude in Section 6 with a ummary of the results and suggestions for future research. . Model The model consists of two parts: the demand model and the rice model. The demand model is based on the heterogeneous mixed) logit model (MXL) for aggregate data, which originates rom Berry (1994) and Berry, Levinsohn, and Pakes (1995) and is iscussed in detail by Nevo (20 0 0) . The original version of the de- and model is extended by time-varying parameters. The price odel serves the purpose of solving the (potential) endogeneity roblem in the demand model via the CF approach (( Kim, 2010 )). .1. Demand model We start in Eq. (1) with the (indirect) utility function. Sup- ose there are i = 1 , . . . , I consumers who choose from j = 1 , . . . , J rands at the time (e.g., weeks) t = 1 , . . . , T the brand providing he highest utility u ijt . To incorporate category purchases, the no- urchase-option is modeled additionally with j = 0 ( Chintagunta, 001 ). i jt = { x  jt it + it ln (p jt ) +  jt + i jt , j = 1 , . . . , J i jt , j = 0 , (1) here x jt is a K  1 vector with exogenous variables (e.g., pro- otion activities) and dummy variables for the brand-intercepts. he log-price 1 variable (ln ( p jt )) is potentially endogenous and is onsidered separately for didactic reasons. Thus, in sum, there are + 1 variables in the utility function. Furthermore, jt and  ijt are two error terms representing dif- erent phenomena.  jt  N(0 ,  2  j ) is normally distributed (with rand-specific variances) and captures demand shocks due to (by he researcher) unmeasured brand characteristics (UMC), since t seems very unlikely that the model contains all variables af- ecting demand and ignoring such UMC might bias the results Chintagunta et al., 2005; Park & Gupta, 2009 ). Additionally, if the MC are correlated with the price-variable (i.e., E [  jt | ln (p jt )]  = 0 ), hey will cause an endogeneity problem and the price effect will e biased ( Petrin & Train, 2010 ). The second error term,  ijt , is ex- reme value type-I distributed and represents consumer-, brand-, escription also apply to a linear price effect. 686 D. Guhl / European Journal of Operational Research 277 (2019) 684698 W a i t f 2 s t m o m 2 i s n p 0 a C l m r a w i m i l W s a t o m T a a W A p b e b i p s e a e i t c i and time-specific randomness (pertaining to the researcher rather than the decision-maker). The parameters of the utility function (1) are consumer- and time-specific and are thus indexed with i and t . Heterogeneity is modeled as being continuous via the normal distribution. The nor- mality assumption is quite convenient because it implies additive- separable dynamics (i.e., changes in the mean values) and hetero- geneity (i.e., deviations of individual values from the mean value): it = t + i and (2) it = t + i , where [  i i ] = i  N ( 0 , ) . (3) The mean values t and t follow a random walk process 2 : t = t1 + t and (4) t = t1 + t , where [  t t ] = t  N ( 0 , Q ) . (5) In contrast to a constant parameter model, the time-dimension (unobservable dynamics) and the consumer-dimension (unobserv- able heterogeneity) both vary. Moreover, our particular specifica- tion is highly flexible, and it also allows for testing alternative specifications (e.g., with/without dynamics and/or with/without heterogeneity) within nested models. To facilitate the understanding of the model and its estimation, it is convenient as well as customary in the literature to structure the utility functions components according to whether they are consumer-specific or not ( Nevo, 20 0 0 ). Substituting Eqs. (2) and (3) into the utility function leads to: u i jt = x  jt ( t + i ) + ( t + i ) ln (p jt ) +  jt + i jt , (6)  u i jt = x  jt t + t ln (p jt ) +  jt     jt + x  jt i + i ln (p jt )    i jt + i jt , (7)  u i jt =  jt + i jt + i jt . (8) jt is the mean utility across consumers, whereas ijt and  ijt con- tain all consumer-specific (heteroscedastic) deviations, which the researcher does not observe. Note that jt includes all variation in the dimensions j (brand) and t (time). Therefore, conditional on jt , biases due to UMC, endogeneity, and dynamics in the utility func- tion are irrelevant. The extreme value distribution of  ijt allows the closed-form derivation of the logit choice probability pr ijt that the utility- maximizing consumer i selects brand j at time t ( Train, 2009 ): pr i jt = exp ( jt + i jt ) 1 +  J k =1 exp (kt + ikt ) . (9) Aggregate market shares s jt result from integrating over the con- sumers unobserved heterogeneous deviations, and since the het- erogeneity in ijt results from i , we have: s jt =    pr i jt ( i ) ( i | 0 , )d i , (10) where  is the density function of a (multivariate) normal distri- bution. Because there is no closed-form solution for the integral of this market share equation, Monte Carlo methods are required to compute s jt . If r denotes the r th draw of  from N( 0 , ), and R is the number of random draws, it follows: s jt  1 R R  r=1 exp (  jt + r jt ( r ) ) 1 +  J k =1 exp ( kt + rkt ( r ) ) . (11) 2 Alternative specifications for the parameter dynamics are possible, e.g., as a function of observed exogenous time-varying variables or in the form of higher- order autoregressive processes (c.f. Van Heerde et al., 2004 and Lachaab et al., 2006 ). However, these specifications are not relevant to the research questions in this paper and are therefore not considered. d 2 E e use random draws based on Halton sequences because they chieve a higher precision for the calculation of the market share ntegrals than pseudorandom numbers ( Train, 2009 ). Multiplying he market share (11) with the market volume leads to the demand or brand j at time t : q jt = M t  s jt . .2. Price model Modeling the price function raises the question of how the ob- erved price variation is caused. The literature distinguishes be- ween two different approaches: structural and descriptive pricing odels ( Chintagunta et al., 2005 ). Structural models assume that bserved prices result from an optimization process, e.g., profit aximization of manufacturers and retailers ( Draganska & Klapper, 007; Yang, Chen, & Allenby, 2003 ). Such models have the follow- ng advantages: (1) in addition to demand, prices are also modeled tructurally, (2) if demand and price models are estimated simulta- eously, the statistical efficiency is higher, and (3) the endogeneity roblem can be solved by explicitly modeling why E [  jt | ln (p jt )]  = holds. However, a disadvantage is that all results are biased if the ssumptions with respect to the price model are incorrect ( Dub & hintagunta, 2003 ). Furthermore, the estimation  especially with ikelihood-based methods and in combination with the demand odel  is quite elaborate ( Yang et al., 2003 , p. 258). In contrast, descriptive (reduced-form) price models are less estrictive because they do not require specific assumptions about n optimization process. We prefer the latter approach, which is hy the mentioned potential bias due to a mis-specified pric- ng mechanism is not a problem here. Nevertheless, reduced-form odels using instrumental variables allow to control for endogene- ty ( Train, 2009 ): n (p jt ) = z  jt  +  jt . (12) e specify the log-price as a linear function of the exogenous in- trumental variables ( z jt ) and need for each endogenous variable t least one instrument. For explaining as much exogenous varia- ion in ln ( p jt ) as possible, z jt also contains all exogenous variables f the demand model ( x jt ), as well as possibly nonlinear transfor- ations and interactions of the variables in z jt ( Jiang et al., 2009 ). he particular choice of valid instruments depends on the specific pplication (see Section 5.2 for more details). Typical instruments re cost shifters ( Chintagunta, 2001 ), lagged prices ( Villas-Boas & iner, 1999 ), or prices of other (geographic) markets ( Nevo, 20 0 0 ). ll instrumental variables are assumed to be correlated with the rice variable, but not with jt . The error term  jt , with  jt  N(0 ,  2  j ) , absorbs any time- and rand-specific deviations of the price variation, from those of the xogenous instruments. As in the demand model, we allow for rand-specific variances. If all the instruments meet the exogene- ty condition, possible correlations of UMC and prices result from rice variations caused by  jt . Thus, the basic idea of Eq. (12) is to eparate the price variation into the part that can be explained by xogenous variables and represents the unbiased price effect ( z  jt ) nd the part that causes the endogeneity problem (  jt ). To keep things simple, we do not consider time-varying param- ters in the price model ( Eq. (12 )) and do not find strong dynamics n preliminary analyses in our empirical application. Nevertheless, his model extension is relevant if the effects of instruments hange considerably over time (e.g., if the retail scenario changes n an emerging economy). We refer to Kim and Kim (2011) for etails. .3. Control function approach As mentioned above, a price-endogeneity problem exists if [  jt | ln (p jt )]  = 0 . There are several possible reasons why UMC D. Guhl / European Journal of Operational Research 277 (2019) 684698 687 a b b u a a m s n ( G t ( s 2[ T e l d (  e[ T E m t  T F  n p b  T 1 E  T t o i a a d ( m c l i t u t a f t m o m ( e 2 a c H ( r S s d p m t m E g p i p   C t c E a i t p 2 r h T o 2 t e  w m 2 r 3 We thank a reviewer for bringing the idea of instrument-free methods to our attention. nd prices correlate ( Train, 2009 , p. 315). If a rather high-priced rand has a better shelf space at the retailer than lower-priced rands, jt and ln ( p jt ) are positively correlated and price effects are nderestimated. On the other hand, if (unobserved) promotional ctivities, such as displays, are combined with price reductions, jt nd ln ( p jt ) are negatively correlated and price effects are overesti- ated. It is important to note that ignoring the UMC term will not olve the endogeneity problem. Furthermore, using more data will ot solve the endogeneity problem because this will not reduce or even eliminate) the correlation between jt and ln ( p jt ) ( Park & upta, 2009; Petrin & Train, 2010 ). A simple yet flexible way to model the correlation between he UMC and the prices is a correlation between the error terms Villas-Boas & Winer, 1999 ). The distribution for  jt and jt re- ults in the following multivariate normal distribution ( Kim & Kim, 011 ):  jt  jt ]  N ([ 0 0 ] , [  2  j  j  j  j  j  j  j  2  j ]) . (13) he covariance matrix in Eq. (13) is denoted as j and all param- ters are brand-specific. This is especially important for the corre- ations  j , because (the degree of) the endogeneity problem can iffer across brands ( Park & Gupta, 2009 ). A Cholesky factorization  j = U  j  U j ) allows us to decompose the correlated error terms jt and jt into the uncorrelated, and standard normal distributed rror terms   jt and   jt ( Train, 2009 , p. 208):  jt  jt ] = [  j 0  j  j  1  2 j  j ]  [   jt   jt ] , with [   jt   jt ]  N(0 , I 2 ) . (14) he utility function can now be set up to satisfy the condition [  jt | ln (p jt )] = 0 . We limit further explanations to jt because the ean utility absorbs the endogeneity problem. Using Eq. (14) leads o: jt = x  jt t + t ln (p jt ) +  j  j  jt +  1  2 j  j   jt . (15) he part of jt correlating with the price is therefore separated. rom Eq. (15) it is clear that there is no endogeneity problem for j = 0 (i.e., no correlation of the error terms) and/or  j = 0 (i.e., o UMC). The price is still correlated with   jt , but we can com- ute an estimated value, e.g., by regressing ln ( p jt ) on z jt .   jt can e calculated from the price Eq. (12) :  jt = 1  j ( ln (p jt )  z  jt  ) . (16) his residual term is the so-called control function (CF) ( Hausman, 978; Heckman, 1978; Petrin & Train, 2010 ), and inserting it into q. (15) leads to: jt = x  jt t + t ln (p jt ) +  j  j 1  j ( ln (p jt )  z  jt  ) +  1  2 j  j   jt . (17) herefore, the idea of the CF approach is that  conditioned on he price models residuals  the original price and the error term f the utility function jt do not correlate. Solving the endogene- ty problem using CF has two advantages. The CF approach (1) can lso be used in models with time-varying parameters and (2) en- bles testing for endogeneity. In the next subsection, we briefly escribe both advantages. See also Kim (2010) and Kim and Kim 2011) for more details. In case suitable instruments are not available, instrument-free ethods for dealing with the endogeneity problems have been re- ently proposed (see Hruschka, 2017 for an overview). In particu- ar, the copula approach of Park and Gupta (2012b) seems promis- ng in our context as it also includes an additional regressor in he model to correct for the endogeneity bias. This correction term ses the nonnormality of the endogenous variable for identifica- ion instead of additional information from exogenous instruments s the CF approach. Implementing and testing such an instrument- ree method for models with time-varying parameters is a poten- ially fruitful area for future research. However, we must keep in ind that if the model is estimated in two stages, the problem f generated regressors arises, which would lead to biased esti- ates for the time-varying parameter; hence, caution is in order cf. Kim & Kim, 2011 for a similar argument regarding a two-step stimation procedure for the CF approach). 3 .3.1. The problem of conventional procedures To solve the endogeneity problem in the demand model, usu- lly, an adjustment of the endogenous variable is carried out using onventional procedures such as 2SLS or the GMM ( Greene, 2011 ). owever, these methods are only applicable if two conditions hold: 1) the model must be linear (in its parameters) and (2) the pa- ameter of the endogenous variable must be constant over time. ince the model of Berry et al. (1995) fulfills both conditions, the tandard procedures apply. Indeed, being able to handle price en- ogeneity with standard methods is the main argument for the ap- roach (outlined in Section 3 ) that linearizes the nonlinear logit odel to estimate aggregate discrete choice models ( Berry, 1994 ). However, linearity is a sufficient condition only if the parame- er of the endogenous variable is not time-varying. In the case of odels with time-varying parameters, a further condition, namely, [  t | t ] = 0 , must be met to avoid an endogeneity bias. The exo- eneity condition, therefore, applies to both, the variables and the arameters. A simple example illustrates that the 2SLS estimator is not valid n the case of time-varying parameters. Suppose the predicted rice  ln (p jt ) = z  jt  is plugged in Eq. (15) . This leads to: jt = x  jt t + t  ln (p jt ) +   jt and (18)  jt =  jt + t ( ln (p jt )   ln (p jt ) ) . (19) onditioned on the exogenous variation of the price (  ln (p jt ) ) the ime-varying parameter t is correlated with the error term   jt reating another endogeneity problem. A closer examination of q. (17) reveals that this issue is irrelevant for the described CF pproach: neither t nor ln ( p jt ) correlate with the error term n Eq. (17) , which is why the CF approach is a valid solution o the endogeneity problem in logit models with time-varying arameters. .3.2. Testing for endogeneity The presented CF approach allows a simple endogeneity test di- ectly via the estimated correlation parameters  j . Under the null ypothesis of a nonexistent endogeneity problem, H 0 :  j = 0 holds. his hypothesis can be checked with a simple t -test for each brand, r with a likelihood-ratio for all brands at the same time ( Greene, 011 ). Such endogeneity tests can be understood as extensions of he test of Hausman (1978) for the case of aggregate logit mod- ls with heterogeneity and time-varying parameters. Note that the regular Hausman test ( Greene, 2011 ) does not apply to models ith time-varying parameters because it is explicitly based on the odels estimated parameters, and here, we have T values. .4. State space model To estimate the time-varying parameters, the previously de- ived demand model (including CF) is formulated compactly as 688 D. Guhl / European Journal of Operational Research 277 (2019) 684698 s i p  T t i E i a t H i f 3 ( l n L T p 3 m 1 e t t a T p p i f c i L T p SSM ( Harvey, 1989 ). The advantage is that the KF recursion can be directly applied to the SSM to determine the time-varying pa- rameters ( Kalman, 1960 ). An SSM consists of two coupled (linear) matrix equations: the observation equation that measures a dy- namic relationship and the state equation that contains the dy- namic relationship itself. For the demand model, the SSM  t is: y t = H t a t + d t +  t , with  t  N ( 0 , R t ) and (20) a t = a t1 + t , with t  N ( 0 , Q t ) . (21) In this paper, the J mean utility functions Eqs. (15) or (17) form the observation Eq. (20) and hence y t = [ 1 t    Jt ] . The matrix H t has the dimension J  (K + 1) and contains all variables with a time-varying effect. This includes the dummy variables for the brand intercepts as well as the marketing-mix variables. The J  1 vector d t incorporates all exogenous influences on the mean util- ity that have no time-varying effect, which are in our case the J effects of the CF: d t = [ 1 1  1 t    J J  Jt ]  . The J  1 error term vector is  t = [  1 t     Jt ]  with the covariance matrix R t = I J  [(1  2 1 )  2 1    (1  2 J )  2 J ]  . The state Eq. (21) includes dy- namics in the parameters according to Eqs. (4) and (5) . Therefore, all time-varying parameters are combined in the (K + 1)  1 vec- tor a t = [  t t ]  . The assumptions according to Eq. (5) apply to the error term t and its covariance matrix Q t . 3. Estimation This section describes the estimation of the model presented previously. We employ a frequentist approach and distinguish two sets of parameters: time-varying parameters in the demand model, and constant parameters in the demand and the price model. We use likelihood-based estimation for the constant parameters and the construction of the likelihood function is explained in Section 3.1 . Based on values for the estimated constant parame- ters, the time-varying parameters can then be estimated using the KF or Kalman Smoother, which Section 3.2 presents. 3.1. Constant parameters All constant parameters ( ,  , vec( ), 0 , 0 , vec( Q ),  , and ) are estimated simultaneously to avoid the problem of gener- ated regressors ( Pagan, 1984 ). If the CF were estimated separately first and then were used as regressors in the demand model subse- quently, the standard errors at the second stage would be invalid due to uncertainty being ignored. Moreover, in dynamic models, this procedure would bias the estimated time-varying parameters (see Kim, 2010 and Kim & Kim, 2011 ). Because simulation techniques are necessary to calculate the market shares in Eq. (10) , the estimation is performed with maxi- mum simulated likelihood (MSL) ( Train, 2009 ). Here, the distribu- tional assumptions regarding the error terms of the demand and price model as well as the time-varying parameters, are used to determine the joint distribution of the unknown parameters given the data. The simulated (log-)likelihood function is derived in four steps: (1) the market share inversion, (2) the calculation of the price models (log-)likelihood function, (3) the calculation of the demand models (log-)likelihood function, and (4) the calculation of the Jacobian. These four steps are discussed in detail below. 3.1.1. Market share inversion The first step contains the market share inversion to obtain jt ( Berry, 1994 ). These mean utility values then serve in the demand model as dependent variable together with the UMC as an error term. For given parameters in  and random draws, rjt can be computed. Berry et al. (1995) suggest a contraction mapping to olve for jt and prove that (for MXL models) a unique solution ex- sts, where predicted and observed market shares equate. We com- ute the following equation iteratively ( Train, 2009 ): (h +1) jt = (h ) jt + ln   s jt s jt (  (h ) t , t )   . (22) he observed and predicted market shares are s jt and s jt , respec- ively, where the latter is a function of the estimated average util- ty values as well as the heterogeneous deviations (see Eq. (11) ). q. (22) is computed until the difference between (h +1) jt and (h ) jt s sufficiently small. We follow ( Dub, Fox, & Su, 2012 ) and choose very strict criterion:  (h +1) jt  (h ) jt  < 1  10 14 ,  j, t . In the case of a model without heterogeneity, jt can be ob- ained via a simple transformation of the observed market shares. ere, the relation  jt = ln ( s jt / s 0 t ) holds ( Berry, 1994 ). The result- ng homogeneous average values are also useful as initial values or the heterogeneous model in Eq. (22) . .1.2. Log-likelihood function of the price model To obtain an estimate for the CF (  jt ), we regress ln (p jt ) on z jt see Eq. (16) ). Since the price model (12) is linear in  jt , the log- ikelihood function follows immediately from the assumption of a ormally distributed error term ( Greene, 2011 , p. 550): P = ln ( L (  P | p , z )) = ln ( T  t=1 J  j=1 f ( p jt , z jt | P )) (23) = 0 . 5  T  t=1 J  j=1 [ ln (2  2  j ) +  2 jt / 2  j ] . (24) he vector  P = [     ]  contains all constant parameters of the rice model. .1.3. Log-likelihood function of the demand model It is helpful to derive the likelihood function of the demand odel via the so-called prediction error decomposition ( Schweppe, 965 ). The main idea is to utilize the distribution of the prediction rrors containing the UMC, instead of directly using the distribu- ion of the UMC. For this purpose, the following KF-equations have o be run through all t = 1 , . . . , T recursively ( Harvey, 1989 ): t | t 1 = a t 1 | t 1 , P t | t 1 = P t 1 | t 1 + Q t , (25) e t = y t  H t a t | t 1  d t , t = H t P t | t 1 H  t + R t , (26) a t| t = a t | t 1 + P t | t 1 H  t 1 t e t , P t| t = P t | t 1 P t | t 1 H  t 1 t H t P t | t 1 . (27) he starting values ( a 0 | 0 = [  0 0 ]  ) are also estimated as constant arameters and in this case P 0|0 is a matrix of zeros ( Harvey, 1989 , . 137). The remaining vectors and matrices follow the definitions n Section 2.4 and remember that y t contains the mean utility t rom the previous market share inversion. The log-likelihood function of the demand model can easily be onstructed with the prediction error e t from the KF recursion and ts covariance matrix t : D = ln ( L (  D | , p , x , )) = ln ( T  t=1 f ( t , p t , x t ,   t | D )) (28) = 0 . 5  T  t=1 [ ln (2  J | t | ) + e  t 1 t e t ] . (29) he vector  D = [    vec ( )  a  0 | 0 vec (Q )  ]  contains all constant arameters of the demand model. D. Guhl / European Journal of Operational Research 277 (2019) 684698 689 3 n l f c a J w w m b c b c p | B i T C a 3 l t d L T M r  T F a 3 r d v a f t a ( u e i w 2 a Table 1 Model specifications and research questions. Model Endogeneity Research question TVP-MXL(CF)  Are the true parameters identified with the correct model? TVP-MXL(IV)  What are the consequences when endogeneity is addressed incorrectly? TVP-MXL  What are the consequences when endogeneity is ignored? P T t t f a i p 4 C p r e a s C p n a c g t d m D ( a s d m s 4 m a e o a i p t t w 0 r .1.4. Calculation of the Jacobian To derive the log-likelihood function of the demand model, a onlinear transformation of the market shares is required. It fol- ows from the change-of-variable theorem for probability density unctions (see, e.g., Greene, 2011 ) that the determinant of the Ja- obian of the nonlinear transformation | J e  s | has to be computed nd added to the log-likelihood function ( Jiang et al., 2009 , p. 137). e  s is the matrix of the first derivatives of the prediction errors ith respect to the market shares. This is a block diagonal matrix ith T blocks of the dimension J  J . Ignoring this term leads to a isspecification of the entire log-likelihood function and hence to iased estimates. However, as shown by Jiang et al. (2009) , the Ja- obian only depends on the heterogeneity parameters (i.e., it can e ignored in MNL models). Because of | J e  s | = | J s  e | 1 , the cal- ulation of the Jacobian determinant is simple ( Jiang et al., 2009 , . 138): J s t  e t | =     s 1 t / e 1 t     s 1 t / e Jt . . . . . . . . .  s Jt / e 1 t     s Jt / e Jt   . (30) ecause the prediction error is linear in t , for the derivative terms n Eq. (30) we have: s jt e kt = { pr i jt (1  pr i jt ) ( i | 0 , )d i j = k,   pr i jt pr ikt ( i | 0 , )d i j  = k. (31) he computation of the integrals in Eq. (31) also requires Monte arlo integration. Conveniently, simulated values ( pr rjt ) are already vailable from the market share inversion. .1.5. Log-likelihood function of the full model The four steps described above enables us to derive the joint og-likelihood function, i.e., the product of the log-likelihood func- ions of the demand and price model as well as the (log) Jacobian eterminant: (  D ,  P | s , x , p , z ) = L D + L P  ln (| J s t  e t | ) . (32) he maximization of this joint log-likelihood function yields the SL estimates for all constant parameters in the model (summa- ized in ): MSL = arg max  L (  D ,  P | s , x , p , z ) . (33) o maximize Eq. (32) we employ the gradient-based Broyden- letcher-Goldfarb-Shanno (BFGS) algorithm ( Greene, 2011 , p. 1099), nd for each iteration, all four steps are necessary. .2. Time-varying parameters To derive the likelihood function of the demand model, the KF ecursion has already been presented. There, calculating the pre- iction errors was its sole purpose. The estimation of the time- ariable parameters was a by-product, and only the information vailable up to and including period t is used. This is appropriate or predictive applications. After estimating the constant parame- ers, the KF can be applied for each period; as soon as new data re available, the time-variable parameters can be updated. However, if we want to include the full information in the data i.e., up to and including period T ) for estimating all parameter val- es for t = 1 , . . . , T (e.g., because we explore parameter dynamics x-post), it is necessary to apply the Kalman Smoother (KS). The KS s also a recursive algorithm that uses the results of the KF back- ards for t = T  1 , T  2 , . . . , 1 ( Petris, Petrone, and Campagnoli, 009 , p. 61): t| T = a t| t + G t ( a t+1 | T  a t+1 | t ) and (34) K t| T = P t| t + G t ( P t+1 | T  P t+1 | t ) G  t . (35) he (K + 1)  (K + 1) -matrix G t with G t = P t| t P 1 T +1 | t , determines he degree of the correction (i.e., how smooth the paths of the ime-varying parameters are). This algorithms purpose is to use the additional available in- ormation to smooth the parameter. Once the constant parameters re estimated, the KFs results from its final iteration are inserted nto the KS to obtain the smoothed estimates of the time-varying arameters ( Petris et al., 2009 , p. 144). . Simulation study In this section, we present the setup and results of a Monte arlo simulation experiment ( Kiviet, 2011 ), which serves three pur- oses. (1) In our simulation, the true model, error terms, and pa- ameters are known. This allows us to evaluate how well differ- nt model specifications are able to recover the true parameters nd how large possible biases are ( Shugan, 2002 ). Additionally, the tatistical efficiency of different approaches is revealed. (2) Monte arlo simulations also help to better understand and interpret em- irical results ( Gelman & Hill, 2007 , p. 157), especially if they do ot have textbook character. (3) There is no standard software vailable for the models in this paper; hence, we wrote our own ode. The simulation is also an important tool for testing our pro- rams ( Cook, Gelman, & Rubin, 2006 ). Starting with a data-generating process (DGP) based on he logit model with heterogeneity, endogeneity, and dynamics, atasets are simulated and then used to estimate three different odel specifications. Model 1 (TVP-MXL(CF)) is the model of the GP and corrects for endogeneity via the CF approach. Model 2 TVP-MXL(IV)) takes heterogeneity, endogeneity, and dynamics into ccount, but incorporates ad hoc endogeneity-adjusted prices in- tead of CF (see Eqs. (18 ) and (19) ). In model 3 (TVP-MXL) en- ogeneity is ignored completely. Therefore, models 2 and 3 are isspecified and serve the purpose of answering three questions hown in Table 1 . .1. Data-generating process The DGP for the simulation is based on the discrete choice odel for aggregate data from Section 2 . We model both demand nd prices for brands in a typical fast-moving consumer goods cat- gory (e.g., canned tuna) at a retailer. The setup is similar to the ne in Jiang et al. (2009) and the empirical study in Section 5 . There are three brands ( J = 3 ) as well as an outside good, nd the demand is only influenced by one (endogenous) market- ng variable, the (log-)price. As an instrument, the (log-)wholesale rice is available, which can be interpreted as a cost for the re- ailer. This logarithmized variable is simulated from a uniform dis- ribution with values in the interval [ 1 . 0 , 0 . 2] , which implies holesale prices between 0.37 and 0.82, with an average value of .56 (sd = 0 . 13 ). To facilitate the identification of time-varying pa- ameters, we opt for a long horizon of T = 300 (weeks) ( Sriram & alwani, 2007 ). 690 D. Guhl / European Journal of Operational Research 277 (2019) 684698 p s t e p m s F p t o g v i n M e d t t d n n 4 ( c e v t m r h n t p l e t s o ( m r t t M t t The simulation study is based on the following parame- terization. In the price model, we assume [ 1 2 3 costs ]  = [0 . 2 0 . 1 0 . 1 0 . 6]  for the three brand intercepts and the cost pa- rameter. Because of the log-prices and log-costs, the cost param- eter can be interpreted as pass-through 4 elasticity with a realistic magnitude of 0.6 (see, e.g., Nijs, Misra, Anderson, Hansen, & Krish- namurthi, 2010 ). For the elements of the covariance matrix  we have  = 0 . 5 ,  = 0 . 2 , and  = 0 . 4 . 5 These values imply that the costs explain approx. 60 % of the price variation and thus there is no problem of weak instruments. The correlation of 0.4 is similar to the value assumed by Jiang et al. (2009) who interpret it as a moderate degree of endogeneity. The positive sign means that pos- itive price shocks are related to positive demand shocks; without endogeneity correction, this lowers price effects in absolute terms. 6 For the parameter values in the utility function at t = 0 , we define [ 10 20 30 0 ]  = [ 5  6  6  5]  . Because only differ- ences in utility matter, brand j = 1 has the highest value. Since the outside good has a utility of zero, the brand intercepts neg- ative (starting) values imply that the outside goods market share is relatively high ( > 90 %). The temporal variation of the parame- ters is based on the standard deviations  = 0 . 05 and  = 0 . 1 . These values generally lead to plausible parameter values for all periods. 7 For the sake of simplicity, heterogeneity is only assumed in the price effect with  =  2 . We employ R = 250 random draws from N(0, 1) based on Hal- ton sequences for simulating the heterogeneity integrals. S = 100 different datasets (replications) are generated by drawing random numbers from the specified distributions of the DGP. Therefore, each replication is based not only on different realizations of the error terms but also on different paths of the time-varying param- eters ( Kim and Kim, 2011 , p. 493). For each replication, constant and time-varying parameters are estimated using the previously described MSL approach and the KS, respectively. 4.2. Results 4.2.1. Constant parameters Table 2 summarizes for each constant parameter (in each model) the mean value and standard deviation, calculated over all replications. We use true parameter values (2nd column) to test for biased estimates. Price model: The results in the price model are very good for all models (i.e., no bias and rather small SD-values). Although the price model is irrelevant for the TVP-MXL model, it was estimated to study the price model in isolation. The results show that the choice of the demand model does not influence the results (ex- cept for rounding errors), which is not surprising since we use a reduced-form price model (i.e., we do not model prices as the out- come of an optimization process of manufacturers and/or retailers). This step, therefore, ensures that the simulation works without er- rors. TVP-MXL(CF) model: Using the correct model also leads to very satisfactory estimation results. The mean values are close to the true values and the empirical standard deviations are small. A sig- nificant (but very small) bias is only present for 10 and  . Of particular interest is  . The simulation demonstrates that it is 4 Pass-through is defined as the fraction of a wholesale price change that the retailer passes through to the consumer. 5 Please note that we refrain here in the sampling experiment from using brand- specific values for the elements in the covariance matrix to keep things simple. 6 Train (2009 , p. 316) and Park and Gupta (2009 , p. 540) discuss the direction of endogeneity biases. All simulations were repeated with a negative correlation (  = 0 . 4 ) without substantially affecting the results. 7 In particular, the price effect should always be negative. This cannot be guaran- teed for random walk processes, but the chosen parameterization aids this condi- tion. t t M o t t t g ( ossible to estimate heterogeneity from aggregate data. The preci- ion of the estimate is comparable to the likelihood-based estima- or of Park and Gupta (2009) . TVP-MXL(IV) model: Using the dynamic model with incorrect ndogeneity correction leads to biased results in all distribution arameters. It is also striking that the estimates in the demand odel are less accurate compared to the TVP-MXL(CF) model; in ome cases, the SD-values are up to five times larger (e.g.,  ) urthermore,  is overestimated. This is plausible because the rice component that is correlated with the UMC is included in he error term. We will discuss consequences for the estimates f the time-varying parameter below. The price parameter hetero- eneity is underestimated on average. However, large standard de- iations indicate very imprecise results. TVP-MXL model: Using the dynamic model without endogene- ty correction leads to the results regarding heterogeneity and dy- amics (  ,  , and  ) that are very similar to the TVP- XL(CF) model. However, the starting values of the utility param- ters ( {  j0 } J j=1 and 0 ) are biased. 0 is (in absolute terms) un- erestimated, which is due to the positive sign of  . Interestingly, he standard deviations of the estimates are almost the same as in he TVP-MXL(CF) model. We can conclude that ignoring price en- ogeneity leads to typical biases in the demand model. However, egative consequences for the estimation of heterogeneity and dy- amics do not seem to exist. .2.2. Time-varying parameters Next, we discuss the results for the time-varying parameters see Table 3 ). To evaluate the quality of the estimations, we cal- ulate for each replication mean error (ME), the root mean square rror (RMSE), the correlation (Cor), and the maximum absolute de- iation (MXAD) per parameter over all periods and then average he results over all replications. TVP-MXL(CF) model: The correct model enables a precise esti- ation of the time-varying parameters. The true and estimated pa- ameter trajectories do not differ much, the correlations are very igh, and the maximum absolute deviations have reasonable mag- itudes, given typical values of the time-varying parameters and heir temporal variation. For example, the majority of the price arameters lie between 8 and 2 and here a maximum abso- ute deviation of 0.71 can be interpreted as small (see Fig. 1 for xamples). TVP-MXL(IV) model: The incorrect endogeneity treatment leads o slightly biased parameter trajectories on average, which can be een from the mean error values. The brand intercepts ( jt ) are verestimated on average, and the time-varying price parameter  t ) is too high. In contrast to the TVP-MXL(CF) model, the esti- ated paths are less correlated with the true parameter trajecto- ies. Also, the maximum absolute deviations are larger. Although he average biases are not particularly high, the results suggest that he estimates of the parameter trajectories are inferior to the TVP- XL(CF) model. TVP-MXL model: The TVP-MXL leads to opposite results. Here, he utility parameters are clearly biased, which also corresponds o the biased starting values shown in Table 2 . The price parame- er is underestimated, and the endogeneity problem is evident. On he other hand, the correlations are of similar size as in the TVP- XL(CF) model, which implies that the estimated parameter paths ver time are recovered well. Compared to the TVP-MXL(IV) model, he maximum absolute deviations are even slightly lower despite he endogeneity bias. In summary, applying the correct model allows a very good es- imation of the time-varying parameters. Neglecting price endo- eneity or accounting for it incorrectly leads to biased estimates in particular the price parameter). The biases, however, are of a D. Guhl / European Journal of Operational Research 277 (2019) 684698 691 Table 2 Results of the Monte Carlo study (constant parameters). TVP-MXL(CF) TVP-MXL(IV) TVP-MXL Parameter True Mean SD Mean SD Mean SD  1 0 .200 0 .201 0 .024 0 .201 0 .023 0 .201 0 .024  2 0 .100 0 .101 0 .021 0 .102 0 .021 0 .101 0 .021  3 0 .100 0 .100 0 .022 0 .101 0 .021 0 .100 0 .022  cost 0 .600 0 .604 0 .032 0 .604 0 .032 0 .602 0 .032   0 .200 0 .199 0 .005 0 .199 0 .005 0 .199 0 .005 10 5 .0 0 0 5 .039  0 .164 5 .032 0 .245 4 .922  0 .164 20 6 .0 0 0 6 .018 0 .145 5 .995 0 .257 5 .855  0 .147 30 6 .0 0 0 5 .988 0 .169 5 .960 0 .272 5 .820  0 .170 0 5 .0 0 0 5 .031 0 .357 5 .084 0 .694 4 .360  0 .355   0 .500 0 .502 0 .063 0 .981  0 .166 0 .475  0 .012  0 .400 0 .396 0 .056  0 .050 0 .047  0 .008 0 .043  0 .016 0 .047  0 .008  0 .100 0 .097 0 .021 0 .073  0 .061 0 .097 0 .022  1 .414 1 .388 0 .173 0 .890  0 .761 1 .436 0 .179 The results are based on S = 100 replications and s summarizes the results of the sth replication for all time-constant parameters of the model. In addition, true is the vector of true parameter values. Mean:  = S 1   S s =1 s and standard deviation (SD):  = (S  1) 1   S s =1 ( s  ) 2 )1 / 2 . ( ) indicates that the t-statistic is greater than the critical value on the 5 % level (| t | > 1.984), with t = S 1 / 2  (   true )  1 . Table 3 Results of the Monte Carlo study (time-varying parameters). TVP-MXL(CF) TVP-MXL(IV) TVP-MXL ME RMSE Cor MXAD ME RMSE Cor MXAD ME RMSE Cor MXAD 1 t < 0.01 0.11 0.91 0.32 0.03 0.17 0.81 0.45 0.11 0.11 0.91 0.39 2 t < 0.01 0.11 0.90 0.33 0.04 0.18 0.75 0.49 0.17 0.11 0.90 0.46 3 t < 0.01 0.12 0.92 0.34 0.04 0.18 0.81 0.49 0.18 0.12 0.92 0.48 t < 0.01 0.22 0.92 0.71 0.04 0.45 0.70 1.29 0.69 0.26 0.92 1.26 The results are based on S = 100 replications each with T = 300 periods and t , s summarizes the results of the sth repli- cation and t th period for all time-varying parameters of the model. In addition,  true t,s is the vector of true parameter val- ues. Fit measured are computed for each replication across time periods and then averaged over replications. Mean error (ME) = S 1   S s =1 T 1   T t=1 ( t,s  true t,s ) ; root mean squared error (RMSE) = S 1   S s =1 (T 1   T t=1 ( t,s  true t,s ) 2 )1 / 2 ; correlation (Cor) = S 1   S s =1 ( T t=1 ( t,s  s )  ( true t,s  true s ) )/ ((  T t=1 ( t,s  s ) 2   T t=1 ( true t,s  true s ) 2 ) 1 / 2 ); max absolute deviation (MXAD) = S 1  S s =1 max t ( abs ( t,s  true t,s ) ) . d  t h a o s F s c t ( T n t M t m r a t i r s n f o 1 d p c M M a 5 r a f 5 d D a a t M w t n H ifferent nature. The results suggest that ignoring endogeneity only shifts the parameters in parallel while representing the shape of he paths over time well. In the TVP-MXL(IV) model, on the other and, the evolutions of utility parameters are also biased, but the verage values are similar to the true (average) values. To further examine these findings, we visually inspect the paths f the price parameters for all replications. We find similar re- ults and can roughly distinguish four scenarios (A, B, C, and D). ig. 1 depicts four replications, each representing one particular cenario. From the four scenarios, the findings discussed in Table 3 be- ome immediately apparent: (1) the TVP-MXL(CF) model is suited o accurately estimate the true price parameter trajectories, and 2) the TVP-MXL model causes a bias in the form of a parallel shift. he TVP-MXL(IV) model leads to different results for the four sce- arios. At best (scenario A), the differences in the results between he TVP-MXL(IV) and the TVP-MXL(CF) model are small. The TVP- XL(CF) model is nevertheless obviously superior. In scenario B, he temporal variation of the price parameter in the TVP-MXL(IV) odel is too small, but there is some similarity to the true pa- ameter trajectory. This kind of bias is presumably less problem- tic than the one of the TVP-MXL model. However, it might also be he case (scenario C) that there is a very high temporal variation n the estimated price parameters of the TVP-MXL(IV) model, thus esulting in a bias that exceeds the bias of the TVP-MXL model. In cenario D, the TVP-MXL(IV) model is not able to identify any dy- amics in the price parameter at all. Here, the TVP-MXL(IV) model ails to fulfill its main purpose and is not useful if the estimation f time-varying parameters is of interest. This happens in 30 of the 00 replications. We conclude from the simulation study that handling en- ogeneity in case of time-varying parameters requires the pro- osed CF approach (TVP-MXL(CF) model). Otherwise, the results an be worse from an incorrect endogeneity treatment (TVP- XL(IV) model) than for ignoring endogeneity completely (TVP- XL model). Furthermore, using the TVP-MXL(IV) model also leads loss of (statistical) efficiency. . Empirical study In this section, we illustrate the application of the model with a eal dataset. After a description of the data, the estimation results re presented and discussed. Finally, the implications of correcting or endogeneity on optimal retail pricing are analyzed. .1. Data We use aggregate data from the Dominicks Finer Foods (DFF) atabase of the University of Chicago (Booth School of Business). 8 FF is one of the major supermarket chains in the greater Chicago rea with more than 80 stores. Weekly values are used for the vari- bles unit sales, price, promotion, and cost (wholesale prices) of he product category canned tuna between September 1989 and ay 1997 (almost 400 weeks). Due to missing values, only 337 eeks are available for the estimation. The data are aggregated at he brand level across the stores, and the four top-selling brands, amely, Bumble Bee (BB), Chicken of the Sea (CS), the store brand eritage House (HH), and StarKist (SK), which are responsible for 8 https://www.chicagobooth.edu/research/kilts/datasets/dominicks . https://www.chicagobooth.edu/research/kilts/datasets/dominicks 692 D. Guhl / European Journal of Operational Research 277 (2019) 684698 Fig. 1. Time-varying price parameters of selected replications. Table 4 Descriptive statistics of the canned tuna category. Variable Bumble Bee Chicken of the Sea Heritage House StarKist Unit sales 1.470 (3.323)  1.443 (3.905) 0.924 (1.328) 2.085 (3.759) Market share 0.223 (0.186) 0.229 (0.186) 0.196 (0.137) 0.352 (0.205) Price 0.779 (0.112) 0.801 (0.085) 0.691 (0.068) 0.804 (0.102) Cost 0.544 (0.056) 0.573 (0.045) 0.497 (0.046) 0.561 (0.051) Promotion 0.234 (0.348) 0.344 (0.405) 0.244 (0.364) 0.308 (0.389) ( ) Mean and standard deviation in parentheses. The variables are scaled as follows: unit sales in 10 4  6-oz cans, market shares in % as well as prices and costs in US $ per 6-oz can. The promotion variable refers to the percentage of the sales sold under promotion. The market shares are inside-good market shares and are therefore conditioned on buying canned tuna. The outside-good itself has a market share of approx. 97 %. p t b H t n f 5 F B a d s b c H 9 Please note that practical reasons mainly drive the choice of the particular dataset. Even though the dataset is more than 20 years old it works well as a sim- ple case study to further illustrate the proposed approach using real data. Given that the dataset is publicly available and has been analyzed before also facilitates reproducibility and interpretation of the results. However, we do not claim that the substantive insights about tuna preferences necessarily still apply today. 10 See also the discussion in Train (2009 , p. 311): More than 80 % of interviewed managers in an empirical study indicate that they are using a fixed markup on the most of the category sales, are used in the analysis. Demand (and prices) refer to tuna with low quality (chunky light) in cans 6- oz (  170 grams). The data contain almost 2 million customers per week (mean = 1934321 , sd = 178550 ) and we use this weekly number of customers to define the market volume ( M t ) for com- puting the market shares of the four brands and the outside good. This calculation is based on the assumption that choices refer to single cans of tuna ( Jiang et al., 2009 ). Table 4 contains descriptive statistics of the DFF data. SK has the largest demand and thus also the highest market share, whereas HH has the lowest demand and the smallest market share. BB and CS are approx. at the same level between HH and SK. The prices of CS and SK are $ 0.8 per can, BB and HH are on average $ 0.02 and $ 0.11 cheaper. A similar picture emerges for the costs. The profit margin for DFF in this category is on average 29 %. The brands differ slightly in the intensity of their promotion activity, where CS has the highest value, followed by SK, BB, and HH. All variables vary significantly over time, which is typical for data at the retailer-level and, of course, helps to identify marketing-mix effects. The DFF dataset, and the canned tuna product category in particular, offers even more advantages in light of our research questions. (1) The data extend over a long pe- riod, which facilitates the identification of time-varying parameters ( Sriram & Kalwani, 2007 ). (2) Heterogeneity ( Jiang et al., 2009 ), en- dogeneity ( Meza & Sudhir, 2006 ), and dynamics in the form of sea- sonal effects ( Chevalier et al., 2003 ) have already been addressed using this dataset. A joint consideration of all three aspects using a flexible modeling approach for the time-varying parameters ap- c ears as a logical extension of the existing research. (3) The canned una market can be adequately modeled with a small number of rands, which reduces the modeling effort of the analysis. BB, CS, H, and SK account for approx. 80 % of the market. (4) Canned una brands are not heavily advertised, so it is not an issue that o data on advertising are available. This would not be the case or other product categories, e.g., beer or laundry detergent. 9 .2. Instruments For the CF approach, we need suitable instrumental variables. ollowing ( Chintagunta, 20 02; Meza & Sudhir, 20 06 ), and ( Sriram, alachander, & Kalwani, 2007 ), we choose the wholesale price as n instrument for the retailers price. Several reasons support this ecision (see Chintagunta, 2002 , p. 147 for more details): Whole- ale prices are generally highly correlated with the retailers prices ecause for the retailer the wholesale prices can be interpreted as osts. When costs change, the retailer will probably adjust prices. 10 owever, the UMCs are most likely uncorrelated with costs, e.g., ost for pricing (cost-plus pricing). D. Guhl / European Journal of Operational Research 277 (2019) 684698 693 t w r f i n S s a c h c t s s F t p r i s c i s q a 2 a m T e H r m p w f m h a s d a i E s l W t t p t c i c p 5 m c p l i m t h e a l d t fi d s i s o c e L ( i s t q b i p i s p m r w p c u i p d t t t H z i u e he retailer will not usually adjust the shelf space allocation when holesale prices change. On the other hand, Rossi (2014) critically emarks that wholesale prices would not be exogenous if manu- acturers adjust this variable to market conditions. In our case, this s unlikely because DFF with 25 % of all supermarket sales does ot dominate the retail market in Chicago ( Chintagunta, Dub, & ingh, 2003 ). Hence, it seems unlikely that (sales shifts of) DFF hould have an impact on wholesale prices, which have to be set t the market level in any case (not the retail chain level), ac- ording to Chintagunta (2002) . Furthermore, the wholesale price as proven to be a valid instrument throughout several empiri- al studies: Nijs, Srinivasan, and Pauwels (2007) investigated de- erminants of retailer prices and profits and concluded that whole- ale prices play an important role. Since the authors examined the ame DFF data as we do, this particularly applies to our study. ong, Simester, and Anderson (2011) cooperated with a retailer for heir study. Price elasticities estimated from data of a joint field ex- eriment were compared with price elasticities calculated from the etailers nonexperimental data. As expected, the estimated elastic- ties were biased due to endogeneity. However, using the whole- ale price as instrument solved the problem and the authors con- lude: The wholesale price instrument eliminates far more bias than t introduces, and appears to be an effective way to estimate price ensitivity ( Fong et al., 2011 , p 17). 11 Also, the promotion variable is assumed to be exogenous and ualifies as an instrument for the price of the retailer. This pproach is not unusual in marketing (see, e.g., Chintagunta, 001 and Sriram et al., 2007 ), and DFF store managers confirmed ccording to Chintagunta, Dub, and Singh (2002 , p. 206), that pro- otion activities are typically planned several weeks in advance. herefore, it seems unlikely that the promotion variable and the rror term correlate at the demand level ( Chintagunta et al., 2003 ). owever, promotion activities and prices are generally highly cor- elated as retailers coordinate their prices with their planned pro- otional activities. Finally, an interaction term between the wholesale price and romotion variable explains pass-through differences in promotion eeks, and brand-specific intercepts account for the brands dif- erent price levels (see Table 4 ). Since we use log-prices in the de- and model, the wholesale price is also logarithmized. On the one and, this approach improves the data fit; on the other hand, this pproach makes it easier to interpret the results (in terms of plau- ibility) since in this case the pass-through elasticity is estimated irectly. To get a first impression about the quality of the instruments nd to check their plausibility, a pooled regression of the prices s performed using the aforementioned instrumental variables. q. (36) summarizes the results (with standard errors in parenthe- es): n ( price jt ) = 0 . 027 (0 . 021)  I ( j = BB ) + 0 . 055 (0 . 020)  I ( j = CS ) 0 . 048 (0 . 024)  I ( j = HH ) + 0 . 061 (0 . 021)  I ( j = SK ) + 0 . 397 (0 . 034)  ln ( cost jt ) 0 . 117 (0 . 038)  promotion jt + 0 . 111 (0 . 060)  ln ( cost jt )  promotion jt ,  = 0 . 096 , R 2 = 0 . 548 , N = 1348 . (36) ith an R 2 value of 0.548, the instruments have sufficient explana- ory power. The costs impact prices significantly positive, the pass- hrough elasticity has a plausible value (see Nijs et al., 2010 ), and romotional activities reduce prices significantly. However, the in- eraction term is not significant at the 5 % level. In sum, we con- 11 Nevertheless, the validity of an instrument needs to be checked for each appli- ation separately and we do not argue that wholesale prices are necessarily valid nstruments. T D 1 lude that the instrumental variables are appropriate for our em- irical study. .3. Results Before discussing the estimations results, a brief discussion of odeling or estimation issues that occurred when studying the anned tuna data is in order. A model specification in which all arameters are heterogeneous and correlated with one another, eads to poorly converging and unstable MSL estimates. Especially n combination with time-varying parameters, preliminary esti- ates showed that only price parameter heterogeneity is impor- ant. For this reason, below only the price variable is specified eterogeneously. 12 Seasonality plays a role in the sales of canned tuna. Chevalier t al. (2003) and Meza and Sudhir (2006) use indicator variables nd show that the price elasticity increases during Lent (in abso- ute terms). Lent refers to the period of 6 weeks before Easter Sun- ay, where religious Christians abstain from eating meat. This leads o a period of peak demand for meat substitutes, such as (tuna) sh. One possible explanation for the increase in price elasticity uring this period is that consumers engage in additional price earch and buy tuna more often ( Meza & Sudhir, 2006 ). Combin- ng Lent indicators with time-varying parameters did not provide atisfactory results in this paper, but this is not surprising because f the flexibility of random walk processes. It is more promising to onsider the seasonality in the variance of the UMC. This is very asy within an SSM by specifying the variance as a function of the ent indicators  2  jt =  2  j  exp (   I (t = Lent ) ) . For   = 0 we have temporal) conditional heteroscedasticity, and the KF then works n the weeks during Lent differently. Indeed, this is reasonable ince Chevalier et al. (2003) and Meza and Sudhir (2006) , conclude hat the canned tuna demand is more volatile during Lent (conse- uently  > 0). We tried more complex price models than Eq. (36) , e.g., with rand-specific cost, promotion, and interaction effects, but the fit mproved only marginally. Since the joint MSL estimation of the rice and the demand model is computational somewhat demand- ng, a more parsimonious model specification (without brand- pecific effects) is advantageous. Preliminary analyses (without rice parameter heterogeneity) revealed that the different price odels do not significantly influence the overall results. For this eason, we opt for the simpler version with brand intercepts and ithout brand-specific effects. A meaningful estimation of the TVP-MXL(IV) model is not ossible for the tuna data. Although the likelihood optimization onverges, the parameter estimates are not reasonable. In partic- lar, the price parameter varies over time but has a positive sign n many weeks, which is economically implausible. Moreover, the rice parameter heterogeneity is extremely high. This result un- erlines that the TVP-MXL(IV) model is not suited to investigate ime-varying endogenous price effects. Hence, we do not include his model in the model comparison. Table 5 contains the estimation results of the constant parame- ers for the TVP-MXL and the TVP-MXL(CF) model using R = 10 0 0 alton draws. Many parameters are significantly different from ero and have plausible signs. Moreover, both models share sim- larities and differences in values often lie within the estimates ncertainty. In particular, the standard deviations for time-varying param- ters and error terms are significantly positive in both models. herefore, UMC and dynamics play a major role in the canned 12 This is not unusual in applications in the marketing literature, see e.g., ( Chung, erdenger, & Srinivasan, 2013; Draganska & Klapper, 2007; Kim, Blattberg, & Rossi, 995 ). 694 D. Guhl / European Journal of Operational Research 277 (2019) 684698 Table 5 Estimation results. TVP-MXL TVP-MXL(CF) Parameter Estimate Std. Err. Estimate Std. Err. BB 0 6 . 568 0.205 6 . 339 0.203 CS 0 6 . 416 0.199 6 . 227 0.198 HH 0 7 . 557 0.285 7 . 214 0.283 SK 0 5 . 676 0.172 5 . 501 0.172 promo 0 0 . 041 0.182 0.128 0.183 0 7 . 034 0.963 5 . 777 0.916   BB 0 . 333 0.018 0 . 368 0.036   CS 0 . 396 0.021 0 . 410 0.024   HH 0 . 284 0.017 0 . 285 0.018   SK 0 . 391 0.018 0 . 402 0.024  1 . 363 0.173 1 . 301 0.170  BB 0 . 078 0.018 0 . 085 0.018  CS 0 . 068 0.021 0 . 069 0.021  HH 0 . 121 0.020 0 . 118 0.020  SK 0 . 048 0.012 0 . 043 0.012  promo 0 . 044 0.015 0 . 040 0.014  0 . 423 0.049 0 . 434 0.048  0.787 0.807 1.127 0.690 BB 0 . 546 0.111 CS 0 . 252 0.106 HH 0 . 020 0.164 SK 0 . 208 0.118 L 6455 . 150 6465 . 512 Bold parameters are significantly different from zero (at least) on the 5 % level (two-sided). The L -value refers only to the log-likelihood value of the demand model and the Jacobian, so both models are com- parable. However, the TVP-MXL(CF) model is estimated in one step in- cluding the price model. As the results for the price model are nearly identical to those of the price regression (36) , we omit them here for brevitys sake. m i o t f c o n fi ( H s m a t H c c I c 1 b B t y e a j h T e p a b s r r p G M i H d e t m v l T g t D g 5 m T u t t tuna data, whether endogeneity is considered or not.  is also significantly positive and thus there are more extreme demand shocks during the peak-demand period of Lent. For both mod- els, the UMC variance increases more than threefold (TVP-MXL(CF) model: exp(1.301)  3.673). Heterogeneity is only significant in the TVP-MXL(CF) model (one-sided at the 10 % level). Because  has a reasonable magnitude in both models and is essential for realistic substitution patterns ( Dub et al., 2002 ), the heterogeneous model specification is used nevertheless. The results regarding endogeneity are in the focus of our study. The  j parameters for BB and CS differ from zero significantly. Moreover, the joint null hypothesis that there is generally no en- dogeneity problem is rejected based on a likelihood ratio test with a highly significant 2 statistic of 2  (6455 . 150  6465 . 512) = 20 . 724 , with k = 4 degrees of freedom. This test also shows that the TVP-MXL(CF) model is statistically superior to the TVP-MXL model because both models are nested and only differ in their endogeneity specification. The negative sign of the parameter is worth mentioning. Prices and UMC ( Villas-Boas & Winer, 1999 ) are often positively correlated, but negative correlations are possible and imply that unobserved promotion activities (e.g., coupons, ex- panded shelf-space allocation, or favorable shelf locations) accom- pany price reductions ( Park & Gupta, 2009 ). The top part of Table 5 shows the initial values ( t = 0 ) of the utility parameters. Before further analyzing the estimated paths of these time-varying parameters, an endogeneity bias can be recog- nized from the starting values already. Prima facie, the TVP-MXL models brand utility parameters are too low and the price sensi- tivity (without an endogeneity correction) is too high. This stems from the previously mentioned negative correlation (  j < 0), but tests revealed the difference for none of the parameters is signif- icant if tested separately. Fig. 2 visualizes the paths of the time- varying parameters for both models. All utility parameters have smaller values in the TVP-MXL model than in the TVP-MXL(CF) c odel. On the one hand, these biases match those of the start- ng values; on the other hand, the already discussed parallel shifts f the parameters can be seen again. However, the figure shows hat all parameters vary over time. This variation is also different rom parameter to parameter in form and intensity and does not orrespond to monotonous trends. This demonstrates the superi- rity of the random walk specification, wherein no assumption is eeded a priori ( Lachaab et al., 2006 ). Fig. 2 also contains 95 % con- dence intervals for each parameter. Two aspects are noteworthy. 1) The confidence intervals overlap for both models at any time. owever, this does not indicate whether the endogeneity bias is ignificant. Such a test is performed using the  j parameters, as entioned above and described in Section 2.3.2 . (2) No data are vailable during weeks 331 to 372. The KF and the KS can handle hese missing values without problems and still estimate values. owever, the confidence intervals are wider during this period be- ause the estimates are more uncertain. The brand intercepts for BB, CS, and SK evolve similarly: de- reasing in the first 150 weeks and subsequently increasing again. n absolute terms, SK has the highest values; BB and CS are at a omparable level. HH often has the lowest values (except weeks 00150), but this is not surprising because HH is DFFs store rand. Furthermore, HH has a different path over time compared to B, CS, and SK. After a relatively stable trend in the first 240 weeks here is a significant dip, but the brand intercept recovers within a ear. The promotion parameter has basically a rising trend over the ntire period of the data. However, there are two short downturns, fter 100 and 200 weeks, respectively. The price parameter is sub- ect to very strong fluctuations, which is also apparent from the igh  value of approx. 0.4. The (mean) price parameters of the VP-MXL(CF) model are between 5 . 777 and 1 . 740 , with an av- rage value of 3 . 853 . The average value of the TVP-MXL models rice parameter is 5 . 177 , so the endogeneity bias over time is on verage 1 . 324 (sd = 0.212). As mentioned before, some authors use an interaction term etween the Lent indicator and the price variable to model sea- onal variations in the price effect. A Lent indicator and price pa- ameters of the TVP-MXL(CF) model correlate with 0 . 176 . This eplicates the results of Chevalier et al. (2003) , who find a higher rice sensitivity (in absolute terms) during the Lent period. In a LS dummy regression of the price parameter (based on the TVP- XL(CF) model accounting for estimation uncertainty) on the Lent ndicator, Lent has a highly significant negative effect of 0 . 644 . owever, the low R 2 value of only 3.7 % indicates that the Lent in- icator explains only a small fraction of the time variation. This mphasizes the benefits of a more flexible specification of the ime-varying parameters. It should be noted that t is only the average value of the nor- ally distributed price parameter. For the TVP-MXL(CF) model, the alue of 1.127 for  implies that 90 % of the population values ie between 1 . 851 and 1.851, when the mean value is set to zero. his highlights that price parameter variations caused by hetero- eneity and dynamics can have quite similar magnitudes, although he causes are entirely different. In sum, the model estimation for FFs canned tuna category reveals that heterogeneity and endo- eneity are relevant and all parameters vary over time. .4. Implications for optimal retail-pricing To examine the practical implications of using the correct odel, retail price optimizations based on the TVP-MXL(CF) and VP-MXL model are performed and compared with each other. We se a similar setup as in Kim et al. (1995) and Vilcassim and Chin- agunta (1996) . We assume: (1) the retailer maximizes profits in he canned tuna category for each week in all stores. (2) Retailer ompetition is ignored. (3) The retailer only optimizes prices. The D. Guhl / European Journal of Operational Research 277 (2019) 684698 695 Fig. 2. Estimated parameter paths over time. v t b m a p m O t H p d s E p T t t ( a t p d o c t t i p W f g i m t t g t e s m w T m c o a alues for the promotion and cost variables are known to the re- ailer, but they are considered as given. (4) The comparisons are ased on the first 300 weeks 13 of the data. We perform the opti- ization over several weeks to cover a broad range of values for ll exogenous variables and utility parameter values. (5) The actual rices serve as the basis for a status quo benchmark. For the retailers optimization problem, we have for each t : ax p t t = M t  J  j=1 (p jt  c jt )  s jt (p t ) . (37) ptimal prices within a week are linked because of the structure of he logit model, one brands price has an effect on all other brands. owever, Eq. (37) can be maximized separately for each t , because rices do not have intertemporal effects in the model. The first or- er condition for an optimum is: jt (p  jt ) + J  k =1 s kt (p  t )  p jt  (p kt  c kt )  0 . (38) q. (38) can be written compactly as a matrix equation:  t = c t  t (p t ) 1  s t (p t ) . (39) he vector p t contains the optimal prices for all J brands at he time t . The matrix t (p t ) summarizes all first derivatives of he market shares with respect to the vector of (optimal) prices Chintagunta et al., 2003 ). s t (p  t ) is the vector of the market shares t time t evaluated at the optimal price p t and the J values of he variable costs are found in c t . Because t (p t ) and s t (p  t ) de- end on the optimal prices, Eq. (39) is only an optimality con- ition. However, this equation can be computed iteratively as a 13 Because of many missing values at the end of the investigation period, only 300 f the total 337 weeks are taken into account. o n i ontraction mapping to obtain a numerical solution for the op- imum ( Morrow & Skerlos, 2011 ). Starting with an arbitrary vec- or p (0) t (e.g., average prices) we compute the following equation teratively: (h +1) t = c t  t ( p (h ) t )1  s t (p (h ) t ). (40) e iterate until p (h +1) t  p (h ) t  < 1  10 14 , save the solution as p t or week t , and repeat the optimization for all t = 1 , . . . , T . The al- orithm is easy to implement, robust, and converges quickly. 14 To investigate the consequences of accounting for endogene- ty, optimizations based on the TVP-MXL(CF) and the TVP-MXL odel are carried out. The optimal prices and actual prices are hen plugged into the TVP-MXL(CF) model (the true model) for he calculation of the (hypothetical) market shares and profit mar- ins (see, e.g., Dub, Hitsch, Rossi, & Vitorino, 2008 ). This ensures he comparability of the results since the evaluation of the differ- nt prices refers to the same model. Table 6 summarizes the re- ults of the optimal retail-pricing exercise based on the different odels. The top part shows the results based on the actual prices, hich serve as a benchmark. The market shares generated by the VP-MXL(CF) model are quite close to the true values. Actual profit argins are between 27 % and 28.5 % and the retailers profit for the anned tuna is on average $ 8283 per week. The middle part of the table presents the results of the price ptimization based on the TVP-MXL(CF) model. The optimal prices re (on average) only slightly lower than the actual prices, with 14 Note that Morrow and Skerlos (2011) studied also more sophisticated versions f fixed-point iterations with better properties for problems with hundreds of alter- atives in the choice set. Because of the rather simple setup ( J = 4 ), the fixed-point teration based on markups works well in our application. 696 D. Guhl / European Journal of Operational Research 277 (2019) 684698 Table 6 Optimal retail-pricing. Brand Price Market share (cond.)  Market share (uncond.)  Profit margin Actual prices Bumble Bee 0.764 (0.108)  22.055 (12.887) 0.529 (0.488) 28.356 (10.322) Chicken of the Sea 0.792 (0.086) 22.060 (12.743) 0.557 (1.063) 26.977 (9.016) Heritage House 0.687 (0.067) 19.483 (11.603) 0.467 (0.625) 27.096 (9.911) StarKist 0.795 (0.096) 36.401 (15.716) 0.929 (1.204) 28.4 84 (8.96 8) Retailer Profit 8282.926 (4977.618) Optimal prices based on the TVP-MXL(CF) model Bumble Bee 0.727 (0.086) 23.059 (8.718) 0.695 (0.528) 25.497 (4.981) Chicken of the Sea 0.775 (0.069) 19.948 (7.183) 0.618 (1.017) 25.932 (5.154) Heritage House 0.661 (0.063) 19.722 (10.285) 0.641 (1.035) 24.882 (4.490) StarKist 0.761 (0.077) 37.271 (9.255) 1.138 (1.555) 25.800 (5.152) Retailer Profit 9820.554 (5556.297) Optimal prices based on the TVP-MXL model Bumble Bee 0.673 (0.067) 22.945 (8.385) 0.880 (0.589) 19.804 (2.727) Chicken of the Sea 0.714 (0.053) 20.188 (7.058) 0.789 (1.096) 19.869 (2.729) Heritage House 0.618 (0.053) 19.275 (10.015) 0.792 (1.139) 19.726 (2.645) StarKist 0.702 (0.056) 37.592 (9.008) 1.447 (1.590) 19.852 (2.821) Retailer Profit 9519.483 (5594.615) ( ) Mean and standard deviation in parentheses, calculated over weekly values. The small differences compared to the values in Table 4 are explained by the shorter time period of the data (300 weeks). ( ) All market share calculations are based on the TVP-MXL(CF) model. Market shares and profit margins (( price  cost) / price ) are specifie d in percentage values. The conditional market shares refer only to the brands within the category, while the unconditional market shares also include the outside good. Prices and profits are in scaled $ and refer to 6 oz cans. b t g s i t p m s m p N f f l s 6 d i t i u S W n m m s s a differences between $ 0.017 (CS) and $ 0.037 (BB). 15 A similar pic- ture emerges for the profit margins. The lower optimal prices re- duce the attractiveness of the outside good. Also, the conditional market shares change, at the optimum, CS loses about two per- centage points and drops to the level of HH, whereas BB, the former direct competitor of CS, increases its market share by one percentage point. SK expands its market leadership (approx. 0.9 percentage points) and thus remains the most popular tuna brand at DFF. The retailer profit is $ 9820 . 6 per week for optimal prices. This means by using the optimal prices based on the TVP-MXL(CF) model the retailer could increase profits by $ 1538 . 7 per week (  18.6 %). For a whole year, this adds up to almost $ 80 0 0 0. Con- sequently, this is the maximum amount such a model-based opti- mization may cost yearly (including data collection and handling, model evaluation and implementation) to be profitable for the re- tailer. The lower part of the table illustrates what happens when en- dogeneity is ignored in the optimization. The optimal prices based on the TVP-MXL model are much lower (e.g., almost $ 0 . 1 for BB and SK) than the actual prices. Because of this, the profit mar- gins are also smaller, i.e., below 20 %. This is the consequence of the endogeneity bias since it led to an overestimation of the price sensitivity. Due to considerable price reductions, the market shares of the four brands grow strongly compared to the outside good. The profit of the retailer is approx. $ 9519 . 5 . Although this is a higher profit than in the status quo scenario, the increase is about 3 % smaller than in the TVP-MXL(CF) model scenario. If again a whole year is considered, accounting for endogeneity has a value of $ 15657.2. The normative analysis demonstrates that the optimal prices for the retailer based on the TVP-MXL model as well as the actual prices lead to suboptimal profits. In particular, ignoring price en- dogeneity costs the retailer a five-digit amount per year. The re- tailer should, therefore, better employ the TVP-MXL(CF) model for optimal pricing decisions. 15 Given the small differences between the actual and the optimized prices (based on the TVP-MXL(CF) model) on average, we conclude that the optimization would leave the retailers current price image unchanged ( Weber, Steiner, & Lang, 2017 ). ( r a Before closing this section, we want to highlight the applica- ility of the proposed approach. 16 As we rely only on informa- ion that should be readily available to retailers (i.e., weekly ag- regated sales, prices, and costs at the brand-level) the estimation hould be easy. Because of the time-varying parameters, the model s able to address changes in the data and this should foster the rust of practitioners in the results even if they are derived from ast data (i.e., have the best inference at time T given the infor- ation before T ). Assuming that the constant parameters remain table, the retailer does not even have to re-estimate the whole odel if new data arrives (e.g., every week), only the time-varying arameters have to be updated using the KF and KS recursions. ew optimal prices can be obtained by running the optimization or the new periods and because this step is easy, simple, and ast the effort of implementing the proposed approach in a real- ife scenario for retailers carrying many categories should be fairly traightforward. . Summary and conclusions The present paper covers logit models for aggregate sales ata. In addition to consumer heterogeneity and price endogene- ty, these models allow the temporal variation of all parame- ers. Accounting for dynamics is particularly important in market- ng ( Leeflang et al., 2009 ); therefore, the assumption of constant tility functions over time is questionable ( Lachaab et al., 2006 ). ince prices in market data are often endogenous ( Villas-Boas & iner, 1999 ), it seems appropriate to explicitly consider both phe- omena (dynamics and endogeneity) when modeling aggregate de- and. If an endogenous variable has a time-varying effect, standard ethods (2SLS, GMM, etc.) do not lead to valid results. As a uitable solution to the endogeneity problem, a CF approach is uggested and examined comprehensively. The key findings from simulation study and an empirical application are as follows. 1) The proposed CF approach is able to estimate time-varying pa- ameters consistently for aggregate logit models while taking into ccount heterogeneity as well as endogeneity. (2) Biases might be 16 We thank a reviewer for the idea of including this discussion. D. Guhl / European Journal of Operational Research 277 (2019) 684698 697 s r n v d d r ( $ ( s h a t m m w t e b t c p t t a t w w i t e A g S t F C R A A B B B B C C C C C C C C C C D D D D D E F F G G G G H H H H H J J K K K K K K K K K K maller when endogeneity is ignored compared to treating it incor- ectly. (3) A wrong endogeneity correction causes biases in all dy- amic effects. These biases affect not only the absolute parameter alues at a given point in time but also the temporal paths. (4) We emonstrate the relevance of a logit model with heterogeneity, en- ogeneity, and parameter dynamics empirically for data from the etailer DFF in the product category canned tuna. (5) For DFF the appropriate) price optimization has a profit potential of around 80 0 0 0 per year. (6) If the price optimization ignores endogeneity TVP-MXL model), biases in the estimated price sensitivities lead to uboptimal retail prices and yearly profits are more than $ 15600 igher ( + 3.1 %) based on the TVP-MXL(CF) model. The approach postulated here also has limitations and there re several extensions for future research. (1) A specification with ime-varying parameters in the price model to make cost effects ore flexible would be promising ( Kim & Kim, 2011 ). (2) The odel ignores quantity choice and a corresponding extension ould be useful ( Nair, Dub, & Chintagunta, 2005 ). (3) The MSL es- imator is not well suited for large models with many brands and xplanatory variables. In such cases, a Bayesian approach would e more promising ( Jiang et al., 2009; Petris et al., 2009 ). (4) All ime-varying parameters have been modeled as random walk pro- esses, but alternative dynamic models are also possible. In case rior knowledge and data are available, a reparameterization of he time-varying parameters would be useful to understand long- erm marketing-mix effects. (5) In case no suitable instruments are vailable an instrument-free approach would be helpful. For this, he copula approach of Park and Gupta (2012b) in combination ith the KF appears to be a fruitful direction for future research. In sum, we conclude that the proposed MXL-TVP(CF) model is ell suited to model consumer (brand) choice taking heterogene- ty, endogeneity, and in particular dynamics into account. Because he model only uses aggregate data, it is very useful for demand stimation and price optimization at the retailer level. cknowledgments The constructive comments of three anonymous reviewers are ratefully acknowledged. I also thank Winfried Steiner and Hartwig teffenhagen for guidance and support, and Juliet Reiss and Sebas- ian Gabel for detailed feedback on earlier versions of this paper. inancial support by Deutsche Forschungsgemeinschaft through RC TRR 190 is gratefully acknowledged. eferences ckerberg, D. , Benkard, C. L. , Berry, S. , & Pakes, A. (2007). Econometric tools for analyzing market outcomes. In J. J. Heckman, & E. E. Leamer (Eds.), Handbook of econometrics Vol. 6A, North-Holland, Amsterdam (pp. 41724276) . llenby, G. M. , & Rossi, P. E. (1999). Marketing models of consumer heterogeneity. Journal of Econometrics, 89 (1/2), 5778 . erry, S. T. (1994). Estimating discrete-choice models of product differentiation. RAND Journal of Economics, 25 (2), 242262 . erry, S. T. , Levinsohn, J. , & Pakes, A. (1995). Automobile prices in market equilib- rium. Econometrica, 63 (4), 841890 . esanko, D. , Gupta, S. , & Jain, D. (1998). Logit demand estimation under compet- itive pricing behavior: An equilibrium framework. Management Science, 44 (11), 15331547 . odapati, A. V. , & Gupta, S. (2004). The recoverability of segmentation structure from store-level aggregate data. Journal of Marketing Research, 41 (3), 351364 . asado, E. , & Ferrer, J.-C. (2013). Consumer price sensitivity in the retail industry: Latitude of acceptance with heterogeneous demand. European Journal of Opera- tional Research, 228 (2), 418426 . hevalier, J. A. , Kashyap, A. , & Rossi, P. E. (2003). Why dont price rise during periods of peak demand? evidence from scanner data. American Economic Review, 93 (1), 1537 . hintagunta, P. K. (2001). Endogeneity and heterogeneity in a probit demand model: Estimation using aggregate data. Marketing Science, 20 (4), 442456 . hintagunta, P. K. (2002). Investigating category pricing behavior at a retail chain. Journal of Marketing Research, 39 (2), 141154 . hintagunta, P. K. , Dub, J.-P. , & Goh, K. Y. (2005). Beyond the endogeneity bias: The effect of unmeasured brand characteristics on household-level brand choice models. Management Science, 51 (5), 832849 . hintagunta, P. K. , Dub, J.-P. , & Singh, V. (2002). Market structure across stores: An application of a random coefficients logit model with store level data. In P. H. Franses, & A. L. Montgomery (Eds.), Econometric models in marketing: 16 (pp. 191221). Amsterdam: Elsevier . hintagunta, P. K. , Dub, J.-P. , & Singh, V. (2003). Balancing profitability and cus- tomer welfare in a supermarket chain. Quantitative Marketing and Economics, 1 (1), 111147 . hintagunta, P. K. , Jain, D. C. , & Vilcassim, N. J. (1991). Investigating heterogeneity in brand preferences in logit models for panel data. Journal of Marketing Research, 28 (4), 417493 . hung, K. Y. C. , Derdenger, T. P. , & Srinivasan, K. (2013). Economic value of celebrity endorsements: Tiger woods impact on sales of nike golf balls. Marketing Science, 32 (2), 271293 . ook, S. R. , Gelman, A. , & Rubin, D. R. (2006). Validation of software for Bayesian models using posterior quantiles. Journal of Computational and Graphical Statis- tics, 15 (3), 675692 . raganska, M. , & Klapper, D. (2007). Retail environment and manufacturer compet- itive intensity. Journal of Retailing, 83 (2), 183198 . ub, J.-P. , & Chintagunta, P. J. (2003). Comment (on Bayesian analysis of simultane- ous demand and supply). Quantitative Marketing and Economics, 1 (3), 293298 . ub, J.-P. , Chintagunta, P. K. , Petrin, A. , Bronnenberg, B. , Goettler, R. , Seethara- man, P. B. , et al. (2002). Structural applications of the discrete choice model. Marketing Letters, 13 (3), 207220 . ub, J.-P. , Fox, J. T. , & Su, C.-L. (2012). Improving the numerical performance of static and dynamic aggregate discrete choice random coefficients demand esti- mation. Econometrica, 80 (5), 22312267 . ub, J.-P. , Hitsch, G. J. , Rossi, P. E. , & Vitorino, M. A. (2008). Category pricing with state-dependent utility. Marketing Science, 27 (3), 417429 . rdem, T. , Keane, M. P. , & Sun, B. (2008). The impact of advertising on consumer price sensitivity in experience goods markets. Quantitative Marketing and Eco- nomics, 6 (2), 139176 . oekens, E. W. , Leeflang, P. S. H. , & Wittink, D. R. (1999). Varying parameter models to accommodate dynamic promotion effects. Journal of Econometrics, 89 (12), 24 926 8 . ong, N. M. , Simester, D. I. , & Anderson, E. T. (2011). Private label vs. national brand price sensitivity: Evaluating non-experimental identification strategies. Technical Report . MIT, Sloan School of Management . elman, A. , & Hill, J. (2007). Data analysis using regression and multilevel/hierarchical models . Cambridge: Cambridge University Press . reene, W. H. (2011). Econometric analysis (7th ed). Pearson, Edinburgh Gate . uadagni, P. M. , & Little, J. D. C. (1983). A logit model of brand choice calibrated on scanner data. Marketing Science, 2 (3), 203238 . upta, S. , Chintagunta, P. K. , Kaul, A. , & Wittink, D. R. (1996). Do household scanner data provide representative inferences from brand choices: A comparison with store data. Journal of Marketing Research, 33 (4), 383398 . arvey, A. C. (1989). Forecasting, structural time series models and the Kalman filter . Cambridge: Cambridge University Press . ausman, J. (1978). Specification tests in econometrics. Econometrica, 46 (6), 12511271 . eckman, J. (1978). Dummy endogenous variables in a simultaneous equation sys- tem. Econometrica, 46 (4), 931959 . ruschka, H. (2010). Considering endogeneity for optimal catalog allocation in direct marketing. European Journal of Operational Research, 206 (1), 239247 . ruschka, H. (2017). Functional flexibility, latent heterogeneity and endogeneity in aggregate market response models. Marketing ZFP  Journal of Research and Management, 39 (3), 1731 . edidi, K. , Mela, C. F. , & Gupta, S. (1999). Managing advertising and promotion for long-run profitability. Marketing Science, 18 (1), 122 . iang, R. , Manchanda, P. , & Rossi, P. E. (2009). Bayesian analysis of random coefficient logit models using aggregate data. Journal of Econometrics, 149 (2), 136148 . alman, R. E. (1960). A new approach to linear filtering and prediction problems. Transactions of the ASMEJournal of Basic Engineering, 82 (Series D), 3545 . alouptsidis, N. , & Psaraki, V. (2010). Approximations of choice probabilities in mixed logit models. European Journal of Operational Research, 200 (2), 529535 . eane, M. P. (1997). Modeling heterogeneity and state dependence in consumer choice behavior. Journal of Business & Economic Statistics, 15 (3), 310327 . im, B.-D. , Blattberg, R. C. , & Rossi, P. E. (1995). Modeling the distribution of price sensitivity and implications for optimal retail pricing. Journal of Business & Eco- nomic Statistics, 13 (3), 291303 . im, C.-J. (2006). Time-varying parameter models with endogenous regressors. Eco- nomics Letters, 91 (1), 2126 . im, C.-J. (2010). Dealing with endogeneity in regression models with dynamic co- efficients. Foundations and Trends in Econometrics, 3 (3), 165266 . im, Y. , & Kim, C.-J. (2011). Dealing with endogeneity in a time-varying parame- ter model: joint estimation and two-step estimation procedures. Econometrics Journal, 14 , 4 874 97 . iviet, J. F. (2011). Monte carlo simulation for econometricians. Foundations and Trends in Econometrics, 5 (1/2), 1181 . k, A. G. , & Fisher, M. L. (2007). Demand estimation and assortment optimization under substitution: Methodology and application. Operations Research, 55 (6), 10011021 . opalle, P. K. , Mela, C. F. , & Marsh, L. (1999). The dynamic effect of discounting on sales: Empirical analysis and normative pricing implications. Markeitng Science, 18 (3), 317332 . https://doi.org/10.13039/501100001659 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0003 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0003 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0017 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0017 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0017 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0017 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0018 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0018 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0018 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0018 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0019 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0020 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0020 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0020 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0020 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0020 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0021 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0021 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0021 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0021 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0021 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0021 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0022 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0022 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0022 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0022 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0022 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0023 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0023 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0023 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0023 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0023 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0024 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0024 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0024 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0024 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0024 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0025 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0025 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0025 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0025 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0026 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0026 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0027 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0027 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0027 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0027 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0028 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0028 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0028 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0028 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0028 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0028 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0029 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0029 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0030 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0030 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0031 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0031 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0032 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0032 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0033 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0033 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0034 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0034 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0034 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0034 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0034 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0035 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0035 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0035 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0035 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0035 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0036 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0036 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0037 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0037 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0037 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0037 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0038 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0038 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0039 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0039 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0039 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0039 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0039 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0040 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0040 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0041 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0041 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0042 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0042 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0042 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0042 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0043 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0043 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0044 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0044 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0044 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0044 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0045 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0045 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0045 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0045 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0045 698 D. Guhl / European Journal of Operational Research 277 (2019) 684698 P R R S S S T V W Y Lachaab, M. , Ansari, A. , Jedidi, K. , & Trabelsi, A. (2006). Modeling preference evo- lution in discrete choice models: A Bayesian state-space approach. Quantitative Marketing and Economics, 4 (3), 5781 . Leeflang, P. S. H. , Bijmolt, T. H. , van Doorn, J. , Hanssens, D. M. , van Heerde, H. J. , Verhoef, P. C. , & Wieringa, J. E. (2009). Creating lift versus building the base: Current trends in marketing dynamics. International Journal of Research in Mar- keting, 26 (1), 1320 . Mela, C. F. , Gupta, S. , & Lehmann, D. R. (1997). The long-term impact of promotion and advertising on consumer brand choice. Journal of Marketing Research, 34 (2), 248261 . Meza, S. , & Sudhir, K. (2006). Pass-through timing. Quantitative Marketing and Eco- nomics, 4 (4), 351382 . Morrow, W. R. , & Skerlos, S. J. (2011). Fixed-point approaches to computing BertrandNash equilibrium prices under mixed-logit demand. Operations Re- search, 59 (2), 4 4 4460 . Nair, H. , Dub, J.-P. , & Chintagunta, P. K. (2005). Accounting for primary and sec- ondary demand effects with aggregate data. Marketing Science, 24 (3), 4 4 4 460 . Nevo, A. (20 0 0). A practitioners guide to estimation of random-coefficients logit models of demand. Journal of Economics & Management Strategy, 9 (4), 513 548 . Nijs, V. , Misra, K. K. , Anderson, E. T. , Hansen, K. , & Krishnamurthi, L. (2010). Channel pass-through of trade promotions. Marketing Science, 29 (2), 250267 . Nijs, V. R. , Srinivasan, S. , & Pauwels, K. (2007). Retail-price drivers and retailer prof- its. Marketing Science, 26 (4), 473487 . Pagan, A. (1984). Econometric issues in the analysis of regressions with generated regressors. International Economic Review, 25 (1), 221247 . Park, S. , & Gupta, S. (2009). Simulated maximum likelihood estimator for the ran- dom coefficient logit model using aggregate data. Journal of Marketing Research, 46 (4), 531542 . Park, S. , & Gupta, S. (2012a). Comparison of SML and GMM estimators for the ran- dom coefficient logit model using aggregate data. Empirical Economics, 43 (3), 13531372 . Park, S. , & Gupta, S. (2012b). Handling endogenous regressors by joint estimation using copulas. Marketing Science, 31 (4), 567586 . Pennings, C. L. , & van Dalen, J. (2017). Integrated hierarchical forecasting. European Journal of Operational Research, 263 (2), 412418 . Petrin, A. , & Train, K. E. (2010). A control function approach to endogeneity in con- sumer choice models. Journal of Marketing Research, 47 (1), 313 . etris, G. , Petrone, S. , & Campagnoli, P. (2009). Dynamic linear models with R . New York: Springer . eiss, P. C. , & Wolak, F. A. (2007). Structural econometric modeling: Rationales and examples from industrial organization. In J. J. Heckman, & E. E. Leamer (Eds.), Handbook of econometrics: 6A . North-Holland, Amsterdam: Elsevier . 42804412. ossi, P. E. (2014). Invited papereven the rich can make themselves poor: A critical examination of iv methods in marketing applications. Marketing Science, 33 (5), 655672 . chweppe, F. C. (1965). Evaluation of likelihood functions for Gaussian signals. IEEE Transaction on Information Theory, 11 (1), 6170 . Shugan, S. M. (2002). In search of data: An editorial. Marketing Science, 21 (4), 13 . riram, S. , Balachander, S. , & Kalwani, M. U. (2007). Monitoring the dynamics of brand equity using store-level data. Journal of Marketing, 71 (2), 6178 . riram, S. , Chintagunta, P. K. , & Neelammegham, R. (2006). Effects of brand pref- erence, product attributes, and marketing mix variables in technology product markets. Marketing Science, 25 (5), 440456 . Sriram, S. , & Kadiyali, V. (2009). Empirical investigation of channel reactions to brand introductions. International Journal of Research in Marketing, 26 (4), 345355 . Sriram, S. , & Kalwani, M. U. (2007). Optimal advertising and promotion budgets in dynamic markets with brand equity as a mediating variables. Management Sci- ence, 53 (1), 4660 . rain, K. E. (2009). Discrete choice methods with simulation (2nd ed). New York: Cam- bridge University Press . an Heerde, H. J. , Mela, C. F. , & Manchanda, P. (2004). The dynamic effect of inno- vation on market structure. Journal of Marketing Research, 41 (2), 166183 . Van Heerde, H. J. , & Neslin, S. A. (2008). Sales promotion models. In B. Wierenga (Ed.), Handbook of marketing decision models (pp. 107162). New York: Springer . Vilcassim, N. J. , & Chintagunta, P. K. (1996). Investigating retailer product category pricing from household scanner panel data. Journal of Retailing, 71 (2), 103128 . Villas-Boas, J. M. , & Winer, R. S. (1999). Endogeneity in brand choice models. Man- agement Science, 45 (10), 13241338 . Weber, A. , Steiner, W. J. , & Lang, S. (2017). A comparison of semiparametric and het- erogeneous store sales models for optimal category pricing. OR Spectrum, 39 (2), 403445 . iner, R. S. (1986). A reference price model of brand choice for frequently pur- chased products. Journal of Consumer Research, 13 (2), 250256 . ang, S. , Chen, Y. , & Allenby, G. M. (2003). Bayesian analysis of simultaneous de- mand and supply. Quantitative Marketing and Economics, 1 (3), 251275 . http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0046 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0046 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0046 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0046 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0046 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0046 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0047 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0048 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0048 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0048 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0048 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0048 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0049 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0049 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0049 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0049 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0050 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0050 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0050 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0050 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0051 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0051 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0051 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0051 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0051 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0052 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0052 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0053 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0054 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0054 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0054 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0054 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0054 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0055 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0055 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0056 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0056 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0056 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0056 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0057 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0057 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0057 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0057 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0058 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0058 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0058 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0058 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0059 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0059 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0059 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0059 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0060 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0060 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0060 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0060 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0061 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0061 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0061 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0061 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0061 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0062 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0062 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0062 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0062 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0062 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0063 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0063 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0064 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0064 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0065 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0065 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0066 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0066 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0066 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0066 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0066 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0067 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0067 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0067 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0067 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0067 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0068 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0068 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0068 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0068 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0069 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0069 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0069 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0069 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0070 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0070 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0071 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0071 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0071 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0071 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0071 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0072 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0072 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0072 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0072 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0073 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0073 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0073 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0073 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0074 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0074 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0074 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0074 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0075 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0075 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0075 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0075 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0075 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0076 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0076 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0077 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0077 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0077 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0077 http://refhub.elsevier.com/S0377-2217(19)30222-X/sbref0077 Addressing endogeneity in aggregate logit models with time-varying parameters for optimal retail-pricing 1 Introduction 2 Model 2.1 Demand model 2.2 Price model 2.3 Control function approach 2.3.1 The problem of conventional procedures 2.3.2 Testing for endogeneity 2.4 State space model 3 Estimation 3.1 Constant parameters 3.1.1 Market share inversion 3.1.2 Log-likelihood function of the price model 3.1.3 Log-likelihood function of the demand model 3.1.4 Calculation of the Jacobian 3.1.5 Log-likelihood function of the full model 3.2 Time-varying parameters 4 Simulation study 4.1 Data-generating process 4.2 Results 4.2.1 Constant parameters 4.2.2 Time-varying parameters 5 Empirical study 5.1 Data 5.2 Instruments 5.3 Results 5.4 Implications for optimal retail-pricing 6 Summary and conclusions Acknowledgments References
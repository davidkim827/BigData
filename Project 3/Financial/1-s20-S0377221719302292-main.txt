Optimizing the pipeline planning system at the national oil company European Journal of Operational Research 277 (2019) 727739 Contents lists available at ScienceDirect European Journal of Operational Research journal homepage: www.elsevier.com/locate/ejor Innovative Applications of O.R. Optimizing the pipeline planning system at the national oil company  Martin Quinteros a , , Monique Guignard b , Andres Weintraub c , Marc Llambias d , Camilo Tapia e a Operations Research Division, Empresa Nacional del Petroleo (ENAP), Santiago P.O. 7710088, Chile b OIDD, The Wharton School, University of Pennsylvania, Philadelphia, PA 19104, USA c Industrial Engineering Department, University of Chile, Santiago P.O. Box 2777, Chile d Refining & Commercialization, Empresa Nacional del Petroleo (ENAP), Santiago P.O. 7710088, Chile e Operations Research Division, Empresa Nacional del Petroleo (ENAP), Santiago P.O. 7710088, Chile a r t i c l e i n f o Article history: Received 1 April 2018 Accepted 5 March 2019 Available online 8 March 2019 Keywords: OR in energy Oil and gas Applied integer programming Scheduling Logistics a b s t r a c t This paper describes the creation, development, implementation and impact of a system optimizing the distribution of petroleum products by pipeline at Empresa Nacional del Petroleo, the state-owned oil company in Chile. Refined oil products are sent via a pipeline from a refinery in the South to terminals located between the refinery and the center of the country. The sequencing of different products needs to be determined. This scheduling used to be done by hand, based on experience and on the need to satisfy physical constraints in the pipeline, supply constraints in and out of the refinery and demand constraints from clients. The complexity of the problem and the need to cut down on operating costs suggested turning to optimization, specifically integer programming. The positive results of the project owe a lot to the constant interaction between schedulers, decision makers, and the optimization team, and to the insights provided by the schedulers that allowed to limit the models complexity. The resulting system is easy to use for schedulers thanks to a graphical user interface (GUI), and its solution requires little computer time. It is used once a month for planning the next month operations and negotiating delivery dates and amounts with the clients based on the solution suggested by the model. In addition, in case of an operational disruption in the middle of a month, the model is run again after updating the parameters accordingly. Operating cost savings are of the order of 10%.  2019 Published by Elsevier B.V. 1 p a i d i o d t T s 7 g m t a t g p o c o i p k t h 0 . Introduction ENAP (Empresa Nacional del Petroleo) is the state-owned etroleum company in Chile. The firm does oil and gas exploration nd production in Chile and other countries. Its main business s transforming crude oil into refined petroleum products to be istributed and sold to large retail companies of the Chilean ndustry. One of the distribution systems that ENAP uses is based n pipelines, the other is based on tankers. In this work we escribe an approach developed for the company to rationalize he distribution of some oil products through the main pipeline. his one way 360 km pipeline connects its BioBio refinery to  This research was partially funded by the Complex Engineering Systems In- titute (CONICYT PIA FB018) and Fondecyt grant 1170381 and by CONICYT grant 813110023  Corresponding author. E-mail addresses: martinq46@gmail.com , mquinterosg@enap.cl (M. Quinteros), uignard_monique@yahoo.fr (M. Guignard), aweintra@dii.uchile.cl (A. Weintraub), llambias@enap.cl (M. Llambias), catapiab@enap.cl (C. Tapia). t a w d o w s ttps://doi.org/10.1016/j.ejor.2019.03.007 377-2217/ 2019 Published by Elsevier B.V. hree demand sites further north, in Chillan (a client site), Linares nd San Fernando (ENAPs sites). Inventory levels in the refinery anks increase following production at the refinery and import of asoline and diesel, and decrease by the amounts of refined oil roducts injected into the pipeline. Ideally, one wants to deliver n time the required quantities to the demand points and to ontrol the amount of polluted mixes that can occur depending n the sequence of products sent through the pipeline. Optimiz- ng these operations can be modelled via mixed-integer linear rogramming (MILP). When constructing the model, one needs to eep track over time of the sequence and amounts of products in he pipeline, as well as of the tank levels at the refinery and at he demand sites. Tank capacities and depletion rates affect the mounts that can be delivered over time. At the demand sites, there is demand for six different products, hich we will call saleable products: diesel, propane, butane, two ifferent grades of gasoline, and domestic kerosene. The demand f the clients is defined through an annual commercial contract, hich establishes a monthly delivery volume per product and pecific tolerances (monthly and annual). Because of this contract, https://doi.org/10.1016/j.ejor.2019.03.007 http://www.ScienceDirect.com http://www.elsevier.com/locate/ejor http://crossmark.crossref.org/dialog/?doi=10.1016/j.ejor.2019.03.007&domain=pdf mailto:martinq46@gmail.com mailto:mquinterosg@enap.cl mailto:guignard_monique@yahoo.fr mailto:aweintra@dii.uchile.cl mailto:mllambias@enap.cl mailto:catapiab@enap.cl https://doi.org/10.1016/j.ejor.2019.03.007 728 M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 d l o b r P l o s i o i t s w a o u B i t d n C m t i & p t o s ( p T t n C a a p t a r i s t c t M a s w w s t i u i i t s there are symmetric penalties for both players for either not supplying (ENAPs case) or not taking (clients case) agreed upon quantities. This is particulary important at Chillan where ENAP does not own storage capacity. In Linares and San Fernando, where ENAP owns the stocking tanks, the clients are downstream so the inventory levels at the ENAPs facilities allow some flexibility for complying with agreed upon deliveries. The six products listed above are injected into the pipeline at the refinery and one must decide, at each change of product, the amount and type of the next product, that is how much of which product to send next. Two consecutive products of the same type but of different grades will create in their contact area a mixed product that can be sold at the cheaper price (for gasoline and liquified petroleum gas). If some specific products are injected ad- jacently into the pipeline, a batch of kerosene must be introduced between the two adjacent batches. The mixed products created by the kerosene, generically called interface, need to be reprocessed at a cost. The objective is to schedule the injection of the products into the pipeline and determine the amounts of products in order to minimize the sum of reprocessing costs, penalties for failing to deliver products as contracted in Chillan, and artificial penalties in case stocks fall below the established safety stocks in San Fernando and Linares. An equilibrium must be reached in terms of balancing the tradeoff between the amount of mixed kerosene to be repro- cessed and the length of batches of saleable products. Being more specific, by sending long batches of single products a smaller num- ber of kerosene batches are needed but a potential stockout of the products that are not being send could happen. On the other hand, by sending short batches of saleable products it is possible to have a better control of the inventory levels and penalties at the de- mand points, but a bigger number of kerosene batches would be needed. It is important to notice that this pipeline is always filled with products and operating unless there is an interruption for ei- ther preventive or corrective maintenance. For mechanical reasons, it is important to keep the flow in the pipeline moving all the time and allow no gaps between consecutive batches. For decades ENAP used a manual approach for pipeline scheduling, based on experience and intuition. Since 2014 the model developed allowed to improve the decision making process by reducing both reprocessing of products and penalties. The company has been using the model very successfully, generat- ing cost-savings of about 10% compared to previous years. The optimization part of the system uses a commercial code and its use has been facilitated by a user friendly GUI (Graphical user interface) that is used on a regular basis. The paper is organized as follows. In Section 2 we present a review of the literature related with our work. In Section 3 we de- scribe the pipeline distribution problem at ENAP in a qualitative way. In Section 4 we introduce the general methodology for ad- dressing the problem. In Section 5 we introduce the mathematical model. In Section 6 we describe the actual system implementa- tion at ENAP and the main results obtained. In Section 7 we an- alyze the process for building the GUI tool for ENAPs schedulers. In Section 8 we discuss the impact of the system for the company. Finally, in Section 9 we draw some conclusions. 2. Related work The body of literature describing research on pipeline schedul- ing has been growing since 20 0 0. Although there are several case studies using real data from companies we could not find in the literature evidence of real applications of models in oil and gas companies. Relvas, Matos, and Fialho (2006) formulated an MILP model based on a continuous-time formulation that includes constraints such as mass balances, distribution constraints and product emands. Results generated include the inventory levels at all ocations, the distribution of products between the depots and the rdering of products in the pipeline. This approach is capable of uilding a schedule only for a very short time horizon. A more efined model including inventory constraints is presented by into, Joly, and Moro (20 0 0) . Key decisions in this model involve oading and unloading tanks and pipeline operations. It includes perational constraints, such as mass balances, product demands, equencing constraints and logical constraints. Results generated nclude the distribution of products among the depots and the rdering of products in the pipeline. Two examples are solved, ncluding a real-world system composed of five depots and dis- ributing gasoline, diesel, liquified petroleum gas and jet fuel for a hort 3-days planning horizon The complexity of multi-product pipeline scheduling is related ith the relationship between binary and continuous decision vari- bles. Rejowski and Pinto (2003) developed a MILP discrete-time ptimization models for finding the best order to inject the prod- cts, keep track of inventory levels on the depot along the pipeline. ased on this model, the same authors ( Rejowski & Pinto, 2004 ) mprove the previous model to minimize the product contamina- ion inside pipeline. Gleizes, Cafaro, Mendez, Cerda, and Herrero (2012) introduced a iscrete event simulation system with several sources in a pipeline etwork and a system that assigns servers to demands points. afaro and Cerda (2004) presented a continuous mathematical odel for the multi-product pipeline scheduling problem reducing he calculation time from previous discrete-time attempts. Later on, Cafaro and Cerda formulated a new version minimiz- ng the total operating cost for different network structures ( Cafaro Cerda 2010; 2011; 2012 ). For a multi-branch and multi-product ipeline networks, MirHassani et al. proposed a continuous- ime scheduling formulation taking into account several pipeline perational constraints ( MirHassani & Fani Jahromi, 2011; MirHas- ani & Ghorbanalizadeh, 2008 ). MirHassani, Abbasi, and Moradi 2013) developed a MILP continuous-time model for unidirectional ipelines that can deliver and inject products at the same time. his approach resulted in a better approximation for the compu- ation of the interfaces volume generated along the pipeline that eed to be reprocessed in comparison with the previous work. astro (2010) presented a new continuous-time formulation for ddressing a complex pipeline network involving several refineries nd multiple demand points. Ghaffari and Mostafaei (2015) pro- osed a MILP formulation for multi-product pipeline in which he mathematical model determines both the optimal injections nd delivery schedule in one stage rather than two stages. More ecently, Liao, Liang, Xu, Zhang, and Wang (2018) presented an ntegrated optimization of the pipeline scheduling and pump cheduling through a discrete-time MILP model. In this article he inventory constraints at demand points were not taken into onsideration. In contrast, in this paper safety stocks are explicitly racked in order to protect against demand uncertainty. Meira, agato, Relvas, Barbosa Pvoa, and Neves Junior (2017) presented decomposition approach for a long term scheduling in a single ource multiproduct pipeline network and described a case study ith data from a company. By comparison with most references in the literature, our study orked from the bottom up. We started with a specific practical ituation that had not been optimized before. Sustained efforts o understand all aspects of the problems required continuous nteraction between the main protagonists: modelers and sched- lers as well as managers at ENAP, and the authors, directly or ndirectly. The project included a study of the current operations, ncluding separating essential from nonimportant details, relative o the operations of the refinery, of the pipeline, of the receiving ites belonging to ENAP and linked to customer tanks, vs those M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 729 Fig. 1. Pipeline network. b o t w s t a t l t a o c c o c a a m c 3 e n i i e t m i l T v i m i s r m E c w j d p a a i m e t l c w a t s b m w o u I i u c o s b t w a s s elonging to customers and not controlled by ENAP, and finally f the return to the refinery of product mixes that had to be ransported back for reprocessing. Additional concerns considered ere the on-time deliveries of finished products at the demand ites, and the sequencing of the individual product injections at he refinery. A careful study of the previous shipping patterns plus n attempt at generating patterns of interest, that is patterns hat were feasible in terms of product sequencing and neither too ong nor to short to be practical, yielded a family of initially four, hen more recently six basic patterns that are flexible enough nd still simple enough to be workable and economical in terms f overall costs. In a given pattern, in some cases, the amount of ertain products could be zero, allowing actually a larger set of ombinations including smaller chains. While and after deciding n these main tools, still in close cooperation with the schedulers, ame the construction of a complex MIP model taking all the bove ingredients into account, and still general enough to be pplicable to similar situations in other types of environment. This odel has been in use at ENAP for several years, allowing a closer ontrol of operations and substantial savings for the company. The main contributions of our work are:  We have developed a system based on a MIP model and a friendly user interface that is being successfully used by ENAP for scheduling the distribution of petroleum products through the pipeline for a whole month.  Based on nearly two years of close interaction with the expert at the Logistics Department and pipeline operators we managed to truly identify the key and essential drivers of the operation. Therefore we were able to set the level of complexity that really is worth including in an optimization model for making the end product a trusted decision making tool for the company. . The pipeline system at ENAP and problem description ENAP uses a 360 km pipeline that starts at ENAPs BioBio Refin- ry (ERBB) and goes north. It has 3 demand points, from south to orth, Chillan (Chi), Linares (Lin) and San Fernando (SF) as shown n Fig. 1 . This last point corresponds to the end of the pipeline in ts regular configuration. The pipeline transports 6 products and at ach demand point there are individual tanks to store them. For he demand points in this pipeline network, on average, ENAPs onthly demand is approximately 150,0 0 0 cubic meters. In commercial terms, the company has annual contracts with ts clients, in which demands are given in monthly volumes, al- owing some tolerance. Both players have rights and obligations. he main factors that drive the distribution policies are that the olume should be delivered on time, on specification terms, and n the right amounts. In the case of Chillan, only estimated infor- ation about storage capacity, initial inventories and safety stocks s available. Indeed a client runs that facility and ENAP is not re- ponsible for managing its inventory. In this location ENAP is only esponsible for delivering the specified monthly demands as ho- ogeneously as possible. In the case of Linares and San Fernando NAP owns the terminals, from where the demands of downstream lients must be satisfied. Based on the terminology used in the petroleum industry, we ill call a batch a volume amount of a single product being in- ected in the pipeline. Each batch injected at the origin should be etermined taking into account its arrival times at the demand oints and the volume each client is going to take from it. There re 6 products to be injected in the pipeline in batches and there re volume limitations for them because of operational issues. For nstance, it does not make sense to inject a small batch of 10 cubic eters, so at least 100 cubic meters are required per batch. The planning horizon is a full month in which the demand for ach particular product at each destination should be fulfilled by he sum of the volumes of all the amounts of that product de- ivered to that client. Ten days before the start of a month, the lients specify the demand per product for the incoming month, hich must be among the contractual volumetric tolerance levels, nd ENAP must build a schedule for the delivery of each product o each client at each demand point. In addition, products must atisfy volume and flow rate constraints in the pipeline. One feature of this pipeline is the fact that the consecutive atches of different products are not separated by any physical ethod. That is, the tail of the batch ahead is in direct contact ith the head of the batch behind it. This creates a mixed volume f the adjacent products and must be reprocessed at the refinery nless it can be sold (e.g., G97 mix with G93 it is be sold as G93). n addition, in some cases the insertion of a batch of kerosene ( Ker ) s needed to avoid direct contact between two products. This vol- me needs reprocessing as well. The part of the product that gets ontaminated with the Ker plus the batch of Ker itself must be rec- llected for reprocessing at a cost, and the whole amount is called lop. ENAPs schedulers used to do this assignment by hand, just ased on their experience and common sense. It is clear that given he combinatorial nature of this problem, this manual procedure as suboptimal and ENAPs cost was higher than necessary. Actu- lly, the schedulers used to repeat some patterns of batches that eemed to work reasonably well and satisfied the chemical con- traints. The approach however did not take full advantage of the 730 M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 Fig. 2. Inventory dynamics of a tank at the refinery: The level goes up through im- ports and refinery production and goes down through loading of cabotage vessels, trucks and the pipeline. Fig. 3. Describes the 6 types of sequences considered. Each sequence is character- ized by its positions p 1 , p 2 , . . . , p 6 . Sequences S 5 and S 6 have 6 positions, S 1 and S 3 have 5 positions and S 2 and S 4 have 3 positions. p t s t l t t a c b t s o s o q f i i a a c t 1 n o t S t a a g c l a t c m w 5 m 5 sequences and there were often difficulties delivering on time ac- cording to the agreed upon schedule. Delays resulted in significant penalty costs for ENAP. Motivated by this situation, we developed a mathematical model that captures the logical decisions involved and finds a schedule that minimizes the monthly costs. The model decides which type of sequences to use, in which order, and the volume of product in each batch, to minimize penalty and reprocessing costs. 4. General methodology for addressing the problem From a practical point of view we can formulate the prob- lem described above as follows. Given a monthly demand for six refined oil products at three demand points along the pipeline, the scheduler should decide the order, volume and timing of the batches entering the pipeline while satisfying a set of operational constraints, so as to minimize the overall operating cost. Consider- ing the fact that the refinery supplies volumes to different systems, namely the San Vicente Port for cabotage vessels, the truck loading facility and the pipeline, we include in our model not just the in- ventory levels at the demand points but also the inventory of each product available at the refinery. As Fig. 2 shows, the inventory for each product increases through production at the refinery and di- rect imports of already refined products, and decreases as products are sent via cabotage vessels, trucks and the pipeline. Here, we are only concerned with distribution through the pipeline, and con- sider the volumes available as given inputs. Because of their chemical engineering background and long field experience, ENAPs pipeline schedulers know for any pair of products whether they can be in contact or whether contact should avoided. After several technical meetings with people from the refinery and with operators, we defined a set of six main types of feasible sequences, i.e., sequences that may be injected into the pipeline and satisfy the chemical constraints ( S 1 , S 2 , S 3 , S 4 , S 5 , S 6 ). A sequence consists of several batches following each other in a specific order. The complete list of saleable products is: 93 octane gasoline (G93), 97 octane gasoline (G97), diesel (Die), propane (C3), butane (C3) and domestic kerosene (Kdom). The separator product is regular kerosene (Ker). As an example, in sequence type S 1 the first position is for diesel ( Die ), the second is for kerosene ( Ker ), the third is for 93 octane gasoline (G93), the fourth is for 97 octane gasoline (G97) and the fifth is for 93 octane gasoline (G93) (see Fig. 3 ). A crucial decision that the model makes is the order in which the sequences are entering into the pipeline and the volume in each batch of each sequence. For instance, if the first sequence entering the pipeline is type S 1 , the second is type S 2 and the third is type S 4 , we would see the following: From a pure combinatorial point of view it is clear that the 6 sequences above do not cover all theoretical possibilities. However, from a chemical and operational point of views, they completely satisfy the restrictions and handling of the pipeline at the injection oint. Initially we were using a set of 4 sequences, and after fur- her discussions with the experts, we decided to add two other equences, resulting in minor improvement in the optimal value of he objective function. Adding more sequences however was use- ess, they neither contributed to the optimum nor did they make echnical sense. Indeed every time a new sequence is injected into he pipeline at the refinery, a system of valves must be handled nd some manipulation occurs. As far as the company is con- erned, the current 6 sequences achieve the desired purpose. As was mentioned before in the introduction, the role of the atches called Ker (not a saleable commodity) is to isolate cer- ain pairs of products by avoiding direct contact between them. In ome sequences there are Ker batches inside them ( S 1 , S 5 , S 6 ), in ther cases it is necessary to add a Ker batch between consecutive equences ( S 2 followed by S 4 ). However, if the final saleable batch f a sequence is the same as the initial batch of the following se- uence, then no Ker is needed as a separator. This is the case for S 1 ollowed by S 2 in Fig. 4 . One of the goals of the model is to min- mize the monthly volume of Ker injected in the pipeline because t has a reprocessing cost. In order to explain graphically how a batch of product reaching demand point is split between the amount supplied to a client nd the amount remaining in the pipeline, as described in Fig. 1 , onsider the following example. There is a batch of 30 0 0 cubic me- ers of G93 to be allocated as follows: 800 cubic meters for Chillan, 0 0 0 cubic meters for Linares and 1200 cubic meters for San Fer- ando. In addition, a batch of 20 0 0 cubic meters of DIE is to be ffloading as follows: 10 0 0 cubic meters for Chillan, 500 cubic me- ers for Linares and 500 cubic meters for San Fernando (see Fig. 5 ). ince G93 and DIE are not compatible products (they cannot be in ouch with each other) a Ker batch must be located between them nd collected at the end of the pipeline in San Fernando. In the previous example, a more accurate description would be s follows. Instead of injecting 20 0 0 cubic meters of DIE at the ori- in of the pipeline, the right amount would be 2012 cubic meters onsidering the 12 cubic meters of DIE that are going to be pol- uted for direct contact with Ker . In the same fashion, the right mount of G93 would be 3010 cubic meters taking into account he 10 cubic meters of G93 that are going to be polluted for direct ontact with Ker . As a consequence instead of collecting 30 cubic eters of Ker in San Fernando for reprocessing, the right amount ould be 52 cubic meters (30 + 12 + 10). . The pipeline scheduling optimization model at ENAP We now introduce the definitions and notation used in the odel formulation. .1. Set definitions  R = The refinery in BioBio that supplies the pipeline (Ref)  I = Demand points in the pipeline network (Chi, Lin and SF) M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 731 Fig. 4. Example of sequences. A sequence S 1 is the first entering the pipeline, S 2 is the second and S 4 the third. Fig. 5. Splitting a batch. From a batch of 30 0 0 cubic meters of G93 (red), 800 cubic meters are delivered in Chillan, 10 0 0 cubic meters in Linares and 1200 cubic meters in San Fernando. In parallel, from a batch of 20 0 0 cubic meters of DIE (yellow), 10 0 0 cubic meters are offloaded in Chillan, 500 cubic meters in Linares and 500 cubic meters in San Fernando. A batch of Ker is located between the original batches and collected in San Fernando. (For interpretation of the references to colour in this figure legend, the reader is referred to the web version of this article.) 5  K s = Saleable products: 93 octane gasoline (G93), 97 octane gasoline (G97), diesel ( Die ), domestic kerosene ( Kdom ), propane (C3) and butane (C4)  K = K s  { Ker} , where Ker is the kerosene separator  S = Types of feasible sequences of batches that can be injected at the origin of the pipeline, namely, S 1 , S 2 , S 3 , S 4 , S 5 , S 6 .  P = Positions of the batches within a sequence, p 1 being at the front of the sequence, p 2 in second position, and so on. For in- stance, in S 4 , product Kdom is in second position.  L = Order of sequences as they enter the pipeline, namely, l 1 , l 2 , l 3 , . . . . For instance, in Fig. 4 the first sequence, l 1 , is type S 1 , the second sequence, l 2 , is type S 2 , and the third sequence, l 3 , is type S 4 . The evidence shows that no more than 15 se- quences are needed for a monthly plan horizon. .2. Parameters We now introduce the main parameters used in the model.  prod k = Production rate of product k at the refinery (cubic me- ter per hour)  tlf k = Volume of product k to be delivered per hour at the truck loading facility near the refinery (cubic meter per hour)  dem i , k = Monthly demand for product k at point i ( cubic meter )  demh i , k = Hourly demand, i.e., dem i , k /720  Cap i , k = Tank storage capacity for product k at point i ( cubic meter )  F low i, j = Recommended rate of flow between consecutive de- mand points i and j (cubic meter per hour) 732 M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 Y 5 i  I  SS i , k = Safety stock of product k at demand point i ( cubic meter )  Vmin s , p , Vmax s , p = Minimum (maximum) volume allowed for the product in position p in sequence s ( cubic meter )  VSmin i , s , p = Minimum volume of the product in position p in sequence s to be supplied at demand point i ( cubic meter ) . De- fined for operational reasons in order to avoid very little vol- ume delivered.   = Allowable deviation tolerance for the monthly demand ful- filment at Chillan demand point  Pos p , s , k = 1, if product k is in position p in sequence s ; 0, other- wise  L p , s = 1, if p corresponds to the last position in sequence s ; 0, otherwise  v aKer s,s  = 1, if for chemical reasons a batch of kerosene must be injected between sequences s and s  ; 0, otherwise  IntVol p , s = Volume of the interface generated in position p of sequence s ( cubic meter )  DV p , s = Degraded/upgraded volume in position p of sequence s ( cubic meter ) . This volume is positive when the volume of the product in position p increases by being mixed with some higher quality product from its neighbors. It is negative when the opposite occurs, i.e., there is a loss due to being mixed with an inferior neighbor product, and zero otherwise.  VSeg i , j = Capacity of the pipeline segment between consecutive demand points i and j ( cubic meter )  I I n v i,k = Initial inventory level of product k at point i ( cubic meter )  In v R k 0 = Initial inventory level of product k at the refinery ( cubic meter )  F In v Min i,k , F In v Max i,k = Minimum (maximum) level of inven- tory of product k needed at point i at the end of the planning horizon ( cubic meter )  VolImp k = Volume of product k to be imported per hour (cubic meter per hour)  VolCab k = Volume of product k sent per hour to the San Vicente port to be distributed by tankers (cubic meter per hour)  RepC = Unit reprocessing cost for the slop (US$ per cubic me- ter)  QCont = Uniform unit cost of quality control for the products entering the pipeline (US$ per cubic meter)  COP = Uniform unit penalty cost for violating safety stocks (US$ per cubic meter)  M 1 , M 2 , M 3 , M 4 , M 5 = Constants used in some constraints for logical purposes. They were defined taking into account the or- der of magnitude of the constraint in which they participate. 5.3. Decision variables We now introduce the decision variables used in the model. For simplicity we will call batch ( p , s , l ) the batch in position p of the sequence type s that is injected into the pipeline in position l . Binary variables X s,l = { 1 if a sequence type s is injected in the lth position into the pipeline 0 otherwise s,s  ,l = { 1 if sequence type s in the lth position is followed by s  in the l + 1 th position 0 otherwise Continuous variables  V O k p,s,l = Volume of product k injected in batch ( p , s , l ) at the origin of the pipeline ( cubic meter )  V OU k p,s,l = Volume of V O k p,s,l inside the pipeline that is saleable ( cubic meter )  V D k,i p,s,l = Volume of product k in batch ( p , s , l ) that will be de- livered at point i ( cubic meter )  V R k,i p,s,l = Volume of product k from batch ( p , s , l ) that remains in the pipeline after supplying demand point i ( cubic meter )  In v i,k p,s,l = Inventory level of product k at demand point i imme- diately before batch ( p , s , l ) arrives ( cubic meter )  In v F i,k = Final inventory level of product k at demand point i at the end of the planning horizon ( cubic meter )  In v R k p,s,l = Inventory level of product k at the refinery at the start of injection of batch ( p , s , l ) in the pipeline ( cubic meter )  VolInt = Total volume of the interface collected over the plan- ning horizon ( cubic meter )  VolKer = Total volume of the Ker batches over the planning horizon ( cubic meter )  SlopTotal = Total volume that needs reprocessing, i.e., the sum of VolInt and VolKer ( cubic meter )  TInj p , s , l = Time at which batch ( p , s , l ) is injected into the pipeline (hour)  T ar r i p,s,l = Arrival time of the head of batch ( p , s , l ) at demand point i (hour)  SSV iol k,i p,s,l = Amount of product k below the safety stock (vio- lation) that is allowed at a cost when batch ( p , s , l ) arrives at point i (cubic meter)  TRC = Total reprocessing cost for the overall slop collected dur- ing the time horizon ( US $)  PC = Total penalty cost for injections after the last day of plan- ning month ( US $)  TC = Overall monthly cost: penalty and reprocessing ( US $) .4. Constraints 1. At each sequencing position l at most one type of sequence can be assigned  s  S X s,l  1  l  L 2. If no sequence is assigned to position l , then no sequence can be assigned to position l + 1  s   S X s  ,l  X s,l+1  s  S, l  L, l < | L | 3. The volume of product k in batch ( p , s , l ) has lower and up- per bounded due to operational reasons P os p,s,k  X s,l  V min s,p  V O k p,s,l  P os p,s,k  X s,l  V max s,p  (p, s, l) ,  k  K 4. No volume from batch ( p , s , l ) can be delivered at point i if sequence s is not assigned to position l V D k,i p,s,l  M 1  X s,l  (p, s, l) ,  k, i 5. Lower bounds on the volume delivered at client i V D k,i p,s,l  V Smin i,s,p  P os p,s,k  X s,l  (p, s, l) ,  i,  k  K s 6. Immediately after injection, the saleable part of V O k p,s,l may be increased by product upgrading, decreased by product downgrading and/or by the interface with kerosene V OU k p,s,l  V O k p,s,l + (DV p,s  IntV ol p,s )  X s,l ,  (p, s, l) ,  k  K 7. The amounts delivered to clients are taken from saleable products  V D k,i p,s,l  V OU k p,s,l ,  (p, s, l) ,  k  K M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 733 5 s s  l 8. The total demand at Chillan must be satisfied over the entire planning period. However, a small deviation ( = 7 , 5%) is allowed by commercial contracts. (1  )  dem Chi,k   p P  s  S  l L V D k,Chi p,s,l  (1 + )  dem Chi,k ,  k  K s 9. The total demand at Linares and San Fernando points over the entire planning period must be at least satisfied  p P  s  S  l L V D k,i p,s,l  dem i,k ,  i = Chi,  k  K s Flow conservation constraints 10. The volume of product k in batch ( p , s , l ) that is not go- ing to be delivered in Chillan and will go downstream in the pipeline V R k,Chi p,s,l = V O k p,s,l  V D k,Chi p,s,l ,  (p, s, l) ,  k  K 11. The volume of product k in batch ( p , s , l ) that is not going to be delivered in Linares and will go downstream in the pipeline V R k,Lin p,s,l = V R k,Chi p,s,l  V D k,Lin p,s,l ,  (p, s, l) ,  k  K Balancing the volumes of interface and slop collected in San Fernando 12. If sequence type s is not assigned to position l , then the binary variable linking with sequence type s  in position (l + 1) must be equal to zero Y s,s  ,l  X s,l ,  (s, s  , l) 13. If sequence type s  is not assigned to position (l + 1) , then the binary variable linking with sequence type s in position l must be equal to zero Y s,s  ,l  X s  ,l+1 ,  (s, s  , l) 14. If sequence type s is assigned to position l and sequence type s  is assigned to position (l + 1) then the binary vari- able linking them must be equal to one X s,l + X s  ,l+1  1 + Y s,s  ,l ,  (s, s  , l) 15. Ker separator batches can only be delivered in San Fernando where they will be taken by truck to the refinery for repro- cessing  i = SF V D Ker,i p,s,l = 0 ,  (p, s, l) 16. The overall slop volume generated by the kerosene batches V olKer =  l L  s  S  p P V D Ker,SF p,s,l 17. The overall slop volume generated by the interfaces V olI nt =  l L  s  S  p P I ntV ol p,s  X s,l 18. The overall slop volume is SlopT otal = V olInt + V olKer Injection time constraints 19. The time of injection of batch ( p , s , l ) depends on the deci- sion of selecting, or not, a sequence type s in position l T In j p,s,l  M 2  X s,l ,  (p, s, l) 20. The time of injection of the batch in first position in the first sequence to enter the pipeline is T In j p 1 ,s,l 1 = 0 ,  s 21. The injection times of two consecutive batches in the same sequence depend on each other T In j p,s,l  T In j p1 ,s,l +  k  K V O k p1 ,s,l F low Re f,Chi ,  (p, s, l) | p > 1 22. The injection time of the first batch of a sequence depends on the injection time of the last batch of the previous se- quence and whether or not is necessary the injection of a 30 cubic meters Ker batch in between T In j p1 ,s  ,l+1  ( T In j p,s,l +  k  K V O k p,s,l + 30  v aKer s,s  F low Re f,Chi ) L p,s  M 3 (1  X s  ,l+1 ) ,  p, s, s  , l| l < | L | Arrival time at a destination point 23. The time at which batch ( p , s , l ) arrives at Chillan is greater than or equal to than that of its injection at the origin of the pipeline, plus the time spent in the pipeline segment from there to Chillan T ar r Chi p,s,l  T In j p,s,l + V Seg Re f,Chi F low Re f,Chi  M 4 ( 1  X s,l ) ,  (p, s, l) 24. The time at which batch ( p , s , l ) arrives at demand point i + 1 is greater than or equal to that of its arrival at demand point i , plus the time spent in the pipeline segment from i to i + 1 T ar r i +1 p,s,l  T ar r i p,s,l + V Seg i,i +1 F low i,i +1  M 5 ( 1  X s,l ) ,  (p, s, l) ,  i  { Chi, Lin } Inventory constraints 25. The inventory level of product k at client i when batch ( p , s , l ) arrives is equal to the initial stock plus the collection of all the amounts of product k delivered in the sequences previous to sequence l , as well as in the same sequence if it has more than one position for product k . In v i,k p,s,l = I I n v i,k + [  l  <l  p   s  V D k,i p  ,s  ,l  +  p  <p  s  V D k,i p  ,s  ,l ]  T ar r i p,s,l  demh i,k ,  (p, s, l) ,  i,  k  K s 26. There is a lower bound on the inventory level of product k at demand point i when batch ( p , s , l ) arrives In v i,k p,s,l  SS i,k  SSV iol k,i p,s,l ,  (p, s, l) ,  i,  k  K s 27. There is an upper bound on the volume delivered at each demand point i when batch ( p , s , l ) arrives V D k,i p,s,l  Cap i,k  In v i,k p,s,l ,  (p, s, l) ,  i,  k  K s 28. Finally, we define the nature of the decision variables X s,l  { 0 , 1 } ,  s, l V O k p,s,l , V OU k p,s,l , V R k,i p,s,l , V D k,i p,s,l , In v i,k p,s,l , SSV iol k,i p,s,l  0 ,  (p, s, l) ,  i, k V olI nt, T I n j p,s,l , T Ar r i p,s,l , RC, QCC, P C, T C  0 ,  (p, s, l) ,  i, k .5. Objective function structure 1. The reprocessing cost RC for the overall slop collected during the time horizon is RC = (    Y s,s  ,l  30  v aKer s,s  + Sl opT otal )  RepC 734 M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 Table 1 Key performance measures comparison between 2013, 2014 and 2018. Manual planning Optimized planning Performance measure Oct-13 Nov-13 Dic-13 Jan-14 Feb-14 Mar-14 Jan-18 Feb-18 Mar-18 Volume for reprocessing (cubic meter) 2.040 1.920 1.850 850 790 760 700 715 710 Fulfillment of the demand 85% 87% 86% 94% 94% 95% 97% 98% 98% Table 2 Demand in cubic meter for September 2018. G93 G97 Die K Dom C3 C4 Chillan 20.0 0 0 8.100 42.958 1.095 0 0 Linares 6.400 1.600 13.0 0 0 0 597 1.440 San Fernando 17.400 8.500 27.400 1.216 2.300 2.638 Total 43.800 18.200 83.358 2.311 2.897 4.078 Table 3 Tank capacity in cubic meter for each product. G93 G97 Die K Dom C3 C4 Chillan 5.0 0 0 3.0 0 0 8.665 800 0 0 Linares 8.0 0 0 4.0 0 0 8.0 0 0 2.100 1.400 1.400 San Fernando 18.0 0 0 18.0 0 0 18.0 0 0 900 2.350 2.100 Table 4 Initial inventory levels in cubic meter at each demand point (approximated num- bers in the case of Chillan). G93 G97 Die K Dom C3 C4 Chillan 2.0 0 0 2.200 6.800 600 0 0 Linares 4.800 2.400 4.800 400 700 715 San Fernando 9.600 9.600 9.600 800 1.200 1.100 6 S i 6 a p t o 6 a l d t s c a s n  c ( t 2. The quality control cost QCC for measuring the chemical specifi- cations of all the batches entering the pipeline during the time horizon is Q CC =  l L  s  S  p P  k  K V O k p,s,l  Q Cont 3. The penalty cost PC for inventory levels below the safety stocks is P C =  l L  s  S  p P  i  I  k  K SSV iol k,i p,s,l  COP We are minimizing TC , the overall monthly operational (penalty and quality control) and reprocessing cost for the pipeline: T C = RC + QCC + P C 6. Implementation of the model at ENAP The mathematical model described in the previous section was coded in GAMS 24.4.6 using CPLEX 16.2 as a solver. In terms of the options in GAMS-CPLEX for the prioritization in the branch and bound algorithm, a balance between optimality and feasibility was chosen. The Windows machine used to run the code was a Dell XPS Core i7 with 8 gigabytes RAM, a 2.4 gigahertz processor and a solid state drive. Table 1 shows a comparison between key performance mea- sures for October, November and December in 2013, previous to the use of the optimization model, and January, February and March in 2014 with the pipeline planning made with the help of the model. In addition, January, February and March in 2018 are presented in order to see the impact of the current version of the model and a more mature and skilled group of schedulers at ENAP. It can be seen that the use of the model in 2014 allowed a reduc- tion of 50% or more in the monthly volume for reprocessing from 2013. In addition, an increment of 8%-10% in the fulfillment of the demand and the corresponding reduction in contractual penalty fees with clients was achieved. For illustrative purposes throughout this section we describe the data used to run the model for September 2018. The monthly aggregated demand for the 6 products was about 155,0 0 0 cubic meters. In the optimal solution the injection of 8 sequences was required to fulfill it. As a reminder, in the case of Chillan, the monthly demands are known by contract. The client runs that fa- cility, and ENAP is not responsible for managing its inventory. In this location ENAP is only responsible for delivering the monthly demand as homogeneously as possible according to the monthly agreements. Estimated information about the inventories available allows to define the more convenient dates to deliver the products. 6.1. Monthly demand of product k at client i (dem i,k ) In Table 2 the monthly demand for September 2018 is detailed. The most important product is Die with more than 50% of the en- tire volume. It is important to note that the demand for domestic kerosene ( Kdom ) is highly seasonal. There are months, like the one above, with low demand, but during the winter season the monthly de- mand in the whole system could be as much as 12,0 0 0 cubic meters. .2. Capacity of product k at client i (Cap i,k ) ENAP owns the tanks and distribution centers in Linares and an Fernando. Table 3 shows the storage capacity for each product n each location. .3. Initial inventory level of product k at client i ( I I n v i,k ) The inventory levels at the start of September 2018 for Linares nd San Fernando are detailed in Table 4 At Linares and San Fernando the product is pumped from the ipeline to ENAPs tanks, therefore the initial inventory levels at hese points will influence the decisions relative to the first couple f sequences entering into the pipeline. .4. Safety stock of product k at demand point i ( SS k i ) ENAP typically has more than one tank allocated per product t a given demand point. Based on that, it is more accurate to re- ate the safety stock ( SS ) to the total capacity per product at each emand point. As a general policy, ENAP used to require that the otal inventory per product at each demand point at any moment hould be sufficient to cover the weekly consumption. In the new system we structured the analysis recalling the lassic continuous review inventory model. That is, assuming normal distribution of the demand during lead time L i , the afety stocks are computed as SS = z  L , where z represents the umber of standard deviation related with the service quality and the standard deviation on the demand per unit of time. In our ase, we used z = 2 which represents 97% fulfilment of demand Figs. 6 and 7 ). For each demand point i , the lead time L i was estimated as he transit time of the flow on the pipeline from the refinery to M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 735 Fig. 6. Stock levels at Linares. Table 5 Safety stocks in cubic meter at each demand point (approximated numbers in the case of Chillan). G93 G97 Die K Dom C3 C4 Chillan 500 400 1.600 200 0 0 Linares 1.0 0 0 500 2.0 0 0 200 0 123 San Fernando 1.500 500 2.0 0 0 250 242 187 p s a E 6 s { a p i 6 t f Table 6 Injection schedule in the optimal solution for September 2018, where p i denotes batch i in each sequence. Order Sequence p1 p2 p3 p4 p5 p6 l1 s1 0.00 1.22 1.23 1.59 1.96 l2 s3 2.32 2.69 2.79 3.03 3.13 l3 s6 3.31 3.72 3.73 5.35 5.66 5.67 l4 s3 6.08 6.44 6.55 6.91 7.01 l5 s1 7.39 8.88 8.89 9.25 9.66 l6 s1 10.03 11.25 11.26 11.62 12.03 l7 s2 12.39 12.76 12.86 l8 s1 13.23 14.80 14.81 15.17 15.58 l9 s1 15.95 17.16 17.17 17.54 17.95 l10 s1 18.32 21.81 21.82 22.19 22.60 l11 s2 22.96 23.33 23.65 l12 s1 24.02 27.16 27.17 27.54 27.95 l13 s6 28.31 28.72 28.73 30.04 30.18 30.19 d l 6 F w S T m oint i . Based on this last approach and the new way of doing the cheduling, ENAP was able to run the operation with lower stocks nd fewer stockouts than before. In Table 5 we describe the safety stocks per product at each NAP point under the new setting. .5. Optimal solution: Injections scheduling The optimal solution displayed in Table 6 shows the thirteen equences needed to fulfill the monthly demand based on the set S 1 , . . . , S 6 } defined in Fig. 3 . In addition, the table shows the day nd time at which each batch of each sequence is injected into the ipeline. For instance, the 3rd batch of the 4th sequence is injected n day 6.55 , which means on day 7 at 13:07 PM. approximately. .6. Total volume transported Table 7 shows for each product the total volume in cubic me- er that was scheduled to be injected at the origin of the pipeline or September 2018 and how this volume was allocated among the emand points. The last column represents the slop volume col- ected for reprocessing. .7. Detailed optimal schedule for September 2018 Tables 8 and 9 show the detailed schedule for September 2018. or instance, the 8th sequence entering the pipeline was type S 1 , ith a first batch of 7696 cubic meters of Die that was injected on eptember 14th at 05:34 and finished on September 15th at 19:07. his batch was split into 4147 cubic meters for Chillan, 1138 cubic eters for Linares and 2399 cubic meters for San Fernando. At the 736 M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 Fig. 7. Stock levels at San Fernando. Table 7 Volumes injected, distributed and to be reprocessed as slop in cubic meter during the time horizon. Product Volume (cubic meter) Chillan Linares San Fernando Slop G93 42,683 18,771 6400 17,400 112 G97 17,809 7493 1600 8500 217 Die 80,220 39,736 13,0 0 0 27,400 84 K Dom 2229 1013 0 1216 0 C3 2985 0 597 2300 88 C4 4078 0 1440 2638 0 Ker 330 0 0 330 0 G b T a l s f q c i a 7 m f s end of the pipeline, a slop volume of 12 cubic meters was collected for reprocessing. 6.8. Stock levels The following curves describe the inventory levels at the ENAP facilities. In the case of Linares, they show the inventory for each product over the planning horizon. Similarly, the following curves describe the inventory levels at San Fernando, for each product, over the planning horizon 7. Implementation and graphical user interface (GUI) for ENAP While developing the mathematical model, we had a significant interaction with the pipeline schedulers at ENAP. As a consequence we understood better the kind of graphical and numerical infor- mation that would be useful to them. The GUI that we built also allows the user to easily enter the main parameters of the model before each run. After the user sets up the parameters and presses the link to AMS in the GUI, an Excel macro will run GAMS-CPLEX in the ackground and will print the results of the optimal schedule. hese results are presented in different ways that we developed fter hours of discussions with the schedulers. A trial period al- owed the users to interact with the tool, find errors or incon- istencies that are to be expected in a system created in-house rom scratch. In the first couple of weeks the users asked many uestions and made useful comments and we addressed their con- erns to their satisfaction. We continue to have monthly meetings n which we check the status of the model, update parameters and dd new features if necessary. .1. Computational times Based on the experience of running the model for over 18 onths, we found that a best way for running the model is the ollowing. If after running the model for one hour, no optimal olution has been reached, we stop the run at a 1% gap. In 95% M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 737 Table 8 Detailed schedule for September 2018. Sequence type Origin Volume at demand points (cubic meter) Product Volume (cubic meter) Injection start Injection end Chillan Linares San Fernando Slop s1 Die 6.0 0 0 01-09 0:00 02-09 5:16 1.462 739 3.787 12 Ker 30 02-09 5:16 02-09 5:24 0 0 30 0 G93 1.800 02-09 5:24 02-09 14:11 460 1.240 100 0 G97 1.809 02-09 14:11 02-09 23:01 885 800 100 24 G93 1.800 02-09 23:01 03-09 7:47 240 1.460 100 0 s3 G93 1.800 03-09 7:47 03-09 16:34 1.507 100 171 22 C4 500 03-09 16:34 03-09 19:01 0 0 500 0 C3 1.185 03-09 19:01 04-09 0:47 0 0 1.141 44 C4 500 04-09 0:47 04-09 3:14 0 500 0 0 G93 883 04-09 3:14 04-09 7:32 649 100 100 34 s6 G97 2.0 0 0 04-09 7:32 04-09 17:17 100 100 1.776 24 Ker 30 04-09 17:17 04-09 17:26 0 0 30 0 Die 8.0 0 0 04-09 17:26 06-09 8:28 5.070 2.830 100 0 K Dom 1.541 06-09 8:28 06-09 15:59 699 0 842 0 Ker 30 06-09 15:59 06-09 16:07 0 0 30 0 G93 2.0 0 0 06-09 16:07 07-09 1:53 1.800 100 100 0 s3 G93 1.800 07-09 1:53 07-09 10:40 100 100 1.578 22 C4 500 07-09 10:40 07-09 13:06 0 465 35 0 C3 1.800 07-09 13:06 07-09 21:53 0 597 1.159 44 C4 500 07-09 21:53 08-09 0:19 0 0 500 0 G93 1.800 08-09 0:19 08-09 09:06 1.566 100 100 34 Ker 30 08-09 09:06 08-09 9:15 0 0 30 0 s1 Die 7.347 08-09 9:15 09-09 21:05 3.663 100 3.571 13 Ker 30 09-09 21:05 09-09 21:14 0 0 30 0 G93 1.800 09-09 21:14 10-09 6:01 100 100 1.600 0 G97 2.0 0 0 10-09 6:01 10-09 15:46 1.776 100 100 24 G93 1.800 10-09 15:46 10-09 00:33 434 100 1.266 0 Ker 30 10-09 00:33 10-09 00:41 0 0 30 0 s1 Die 6.0 0 0 11-09 0:41 12-09 5:58 4.439 100 1.449 12 Ker 30 12-09 5:58 12-09 6:06 0 0 30 0 G93 1.800 12-09 6:06 12-09 14:53 100 100 1.600 0 G97 2.0 0 0 12-09 14:53 13-09 0:39 991 100 885 24 G93 1.800 13-09 0:39 13-09 9:25 1.600 100 100 0 s2 G93 1.800 13-09 9:25 13-09 18:12 100 100 1.600 0 C4 500 13-09 18:12 13-09 20:39 0 0 500 0 G93 1.800 13-09 20:39 14-09 05:26 100 100 1.600 0 Ker 30 14-09 05:26 14-09 05:34 0 0 30 0 s1 Die 7.696 14-09 5:34 15-09 19:07 4.147 1.138 2.399 12 Ker 30 15-09 19:07 15-09 19:16 0 0 30 0 G93 1.800 15-09 19:16 16-09 4:02 1.220 100 480 0 G97 2.0 0 0 16-09 4:02 16-09 13:48 100 100 1.776 24 G93 1.800 16-09 13:48 16-09 22:35 1.600 100 100 0 Ker 30 16-09 22:35 16-09 22:43 0 0 30 0 o m 8 f s t o c s 8 c i c o 8 t a a 8 A d r a t d i d o b 8 t m p t f the instances, we obtain an optimal solution in less than 25 inutes. . Impact of the model and cost savings The two main economic impacts brought by the model come rom savings in reprocessing costs for the total slop volume and avings due to a better fulfillment of monthly contractual volumes, hus reducing contractual penalties. The overall economic impact f using the model, considering reduced fines and reprocessing osts, is approximately 10%. For confidentiality reasons is not pos- ible to give further details in this matter. .1. Savings in reprocessing cost Before using our model, on average ENAP used to collect 1500 ubic meters of slop per month (average data from 2013). After mplementing our system, ENAP currently collects only around 750 ubic meters (average data from 2016), that is a reduction in the rder of 50%. This is equivalent to 2% of total cost. .2. Savings in contractual penalties for ENAP These penalties are associated with not fulfilling the con- ract with the client in Chillan. The use of the model yields an pproximate annual reduction of 8% in fines as better scheduling llows a decrease in unfulfilled orders. .3. Quality of service to clients It is important to note that the Chilean fuel market is open. bout 50% of the national demand for diesel is being fulfilled by irect imports. Every client of ENAP has the option of importing efined products from foreign providers. Thus, beside the direct fines to the client in Chillan, there is critical issue of quality of service. Since that client has the op- ion of importing the products directly from other distributors, not elivering in a timely fashion could lead to losing the client. Hav- ng a safety stock policy in San Fernando and Linares allows these istribution centers to provide a better quality of service to their wn downstream clients. The impact of this improvement cannot e measured. .4. Use of the model for evaluating a new way of supplying jet fuel o Maipu So far, we have considered that San Fernando was the last de- and point on the pipeline, but there is also a segment of the ipeline that goes from San Fernando to Maipu in the Metropoli- an region. Maipu is usually supplied by a different pipeline, P , 2 738 M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 Table 9 Detailed schedule for September 2018. Sequence type Origin Volume at demand points (cubic meter) Product Volume (cubic meter) Injection start Injection end Chillan Linares San Fernando Slop s1 Die 6.0 0 0 16-09 22:43 18-09 3:59 2.899 994 2.095 12 Ker 30 18-09 3:59 18-09 4:08 0 0 30 0 G93 1.800 18-09 4:08 18-09 12:55 100 100 1.600 0 G97 2.0 0 0 18-09 12:55 18-09 22:40 1.776 100 100 24 G93 1.800 18-09 22:40 19-09 07:27 1.600 100 100 0 Ker 30 19-09 07:27 19-09 7:36 0 0 30 0 s1 Die 17.220 19-09 7:36 22-09 19:36 7.902 4.265 5.040 13 Ker 30 22-09 19:36 22-09 19:45 0 0 30 0 G93 1.800 22-09 19:45 23-09 4:32 1.600 100 100 0 G97 2.0 0 0 23-09 4:32 23-09 14:17 100 100 1.776 24 G93 1.800 23-09 14:17 23-09 23:04 1.600 100 100 0 s2 G93 1.800 23-09 23:04 24-09 7:51 1.600 100 100 0 C4 1.578 24-09 7:51 24-09 15:32 0 475 1.103 0 G93 1.800 24-09 15:32 25-09 00:19 100 1.600 100 0 Ker 30 25-09 00:19 25-09 0:28 0 0 30 0 s1 Die 15.491 25-09 0:28 28-09 4:02 6.521 100 8.858 12 Ker 30 28-09 4:02 28-09 4:11 0 0 30 0 G93 1.800 28-09 4:11 28-09 12:57 395 100 1.305 0 G97 2.0 0 0 28-09 12:57 28-09 22:43 1.665 100 211 24 G93 1.800 28-09 22:43 29-09 7:30 100 100 1.600 0 s6 G97 2.0 0 0 29-09 7:30 29-09 17:15 100 100 1.776 24 Ker 30 29-09 17:15 29-09 17:24 0 0 30 0 Die 6.467 29-09 17:24 01-10 0:56 3.633 2.734 100 0 K Dom 688 01-10 0:56 01-10 4:18 314 0 374 0 Ker 30 01-10 4:18 01-10 4:27 0 0 30 0 G93 2.0 0 0 01-10 4:27 02-10 02:13 100 100 1.800 0 Fig. 8. Extended pipeline configuration. b i i t c a f 9 p (see Fig. 8 ), which goes from the port of Quintero to the ENAP fa- cility in Maipu. However the BioBio refinery is the only one that produces jet fuel in significant amounts. In order to fulfill Maipus demand of jet fuel there are two possibilities: i) Loading a vessel in the San Vicente port, near the BioBio refin- ery and send the vessel to the Quintero port, where the jet fuel is unloaded and taken to Maipu through P 2 . ii) Injecting the jet fuel at the BioBio refinery and using the regu- lar pipeline and the extra segment to deliver it to Maipu. The pipeline has the capacity to handle this extra load. The first choice was the one mostly used by ENAP. The present model, however, shows that using choice ii) could reduce the cost y 25%. Considering that the monthly demand of jet fuel in Maipu s about 20,0 0 0 cubic meters, this alterative gives ENAP a good sav- ngs opportunity. Based of this finding, ENAP has used this option part of the ime since 2016 with good results. In addition to the economic in- entive just described, sending the jet fuel to Maipu in the pipeline lso freed some capacity on the vessels. This capacity can be used or transporting other products. . Conclusions We have presented an innovative approach for scheduling a ipeline system to transport fuels. To improve the distribution M. Quinteros, M. Guignard and A. Weintraub et al. / European Journal of Operational Research 277 (2019) 727739 739 s m o o O a w c p v a i t s m R C C C C C G G L M M M M P R R R ystem through a pipeline for ENAP we built an optimization odel and a practical computational tool for the company. Use f the system leads to savings in the order of 10% in the cost of perating the pipeline and also allows a better quality of service. ne key aspect for achieving this success was the full cooperation nd involvement of ENAPs Logistic Department. The schedule e computed takes into consideration the main operational and ommercial aspects that rule this distribution process. This was ossible by integrating the operators of the pipeline in the de- elopment of the system. The CEO and the COO of the company ttended the project meetings once a month and that is very rare n a company the size of ENAP. This project has been a milestone for the company and was he kickoff of a new stage in the way they do planning, by witching from manual and empirical planning to an optimization odel. eferences afaro, D. , & Cerda, J. (2004). Optimal scheduling of multiproduct pipeline systems using a non-discrete MILP formulation. Computers and Chemical Engineering, 28 , 20532068 . afaro, D. , & Cerda, J. (2010). Operational scheduling of refined products pipeline networks with simultaneous batch injections. Computers and Chemical Engineer- ing, 34 , 16871704 . afaro, D. , & Cerda, J. (2011). A rigurous mathematical formulation for the schedul- ing of tree-structure pipeline networks. Industrial and Engineering Chemistry Re- search, 50 , 50645085 . afaro, D. , & Cerda, J. (2012). Rigurous scheduling of mesh-structure refined petroleum pipeline networks. Computers and Chemical Engineering, 38 , 185203 . astro, P. (2010). Optimal scheduling of pipeline systems with a resourcetask net- work continuous-time formulation. Industrial and Engineering Chemistry Re- search, 49 , 1149111505 . haffari, A. , & Mostafaei, H. (2015). On the scheduling of real world multiproduct pipelines with simultaneous delivery. Optimization and Engineering, 16 , 134 . leizes, M. , Cafaro, D. , Mendez, C. , Cerda, J. , & Herrero, G. (2012). Managing distribu- tion in refined products pipelines using discrete-event simulation. International Journal of Information Systems and Supply Chain Management, 5 , 5879 . iao, Q. , Liang, Y. , Xu, N. , Zhang, H. , & Wang, J. (2018). An MILP approach for detailed scheduling of multi-product pipeline in pressure control mode. Industrial and Engineering Chemistry Research, 136 , 620637 . eira, W. H. T. , Magato, L. , Relvas, S. , Barbosa Pvoa, A. P. F. D. , & Neves Ju- nior, F. (2017). A decomposition approach for the long-term scheduling of a sin- gle-source multiproduct pipeline network. Operational Research, 223 , 235248 . APDIO,Springer Proceedings in Mathematics and Statistics. irHassani, S. , Abbasi, M. , & Moradi, S. (2013). Operational scheduling of refined product pipeline with dual purpose depots. Applied Mathematical Modelling, 37 , 57235742 . irHassani, S. , & Fani Jahromi, H. (2011). Scheduling multi-product tree-structure pipelines. Computers and Chemical Engineering, 35 , 165176 . irHassani, S. , & Ghorbanalizadeh, M. (2008). The multi-product pipeline schedul- ing system. Computers and Mathematics with Applications, 56 , 891897 . into, J. , Joly, M. , & Moro, L. (20 0 0). Planning and scheduling models for refinery operations. Computers and Chemical Engineering, 24 , 22592276 . ejowski, R. , & Pinto, J. (2003). Scheduling a multiproduct pipeline system. Computer and Chemical Engineering, 27 , 12291246 . ejowski, R. , & Pinto, J. (2004). Efficient MILP formulations and valid cuts for multi- product pipeline scheduling. Computer and Chemical Engineering, 28 , 15111528 . elvas, S. , Matos, H. , & Fialho, J. (2006). Pipeline scheduling and inventory manage- ment of a multiproduct distribution oil system. Industrial and Engineering Chem- istry Research, 23 , 78417855 . http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0001 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0002 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0003 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0003 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0003 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0003 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0004 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0005 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0006 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0007 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0008 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0009 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0010 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0011 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0012 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0013 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0014 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0015 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0016 http://refhub.elsevier.com/S0377-2217(19)30229-2/sbref0016 Optimizing the pipeline planning system at the national oil company 1 Introduction 2 Related work 3 The pipeline system at ENAP and problem description 4 General methodology for addressing the problem 5 The pipeline scheduling optimization model at ENAP 5.1 Set definitions 5.2 Parameters 5.3 Decision variables 5.4 Constraints 5.5 Objective function structure 6 Implementation of the model at ENAP 6.1 Monthly demand of product k at client i (demi,k) 6.2 Capacity of product k at client i (Capi,k) 6.3 Initial inventory level of product k at client i () 6.4 Safety stock of product k at demand point i () 6.5 Optimal solution: Injections scheduling 6.6 Total volume transported 6.7 Detailed optimal schedule for September 2018 6.8 Stock levels 7 Implementation and graphical user interface (GUI) for ENAP 7.1 Computational times 8 Impact of the model and cost savings 8.1 Savings in reprocessing cost 8.2 Savings in contractual penalties for ENAP 8.3 Quality of service to clients 8.4 Use of the model for evaluating a new way of supplying jet fuel to Maipu 9 Conclusions References